window.PhotoSeries=function(){"use strict";let e=0,t=0,n=[],o=null,r=!1,a=1,i=!1,s={x:0,y:0},l={x:0,y:0},c=null,d=null,u=null,m=null;function h(e){y()}function f(t){const n=c.querySelector(".carousel-item.active");if(n){const t=parseInt(n.dataset.photoIndex)||0;e=t,g(e),p()}}function g(e){if(e<0||e>=n.length)return;const o=n[e],r=document.getElementById("photoCounter"),a=document.getElementById("currentPhotoIndex");r&&(r.textContent=`${e+1} de ${t}`),a&&(a.textContent=e+1),m&&o&&function(e){if(!m)return;const t=`\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-file-earmark-text me-1"></i>\n                    Arquivo:\n                </span>\n                <span class="metadata-value">${e.filename}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hdd me-1"></i>\n                    Tamanho:\n                </span>\n                <span class="metadata-value">${e.size||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-aspect-ratio me-1"></i>\n                    Dimensões:\n                </span>\n                <span class="metadata-value">${e.dimensions||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hash me-1"></i>\n                    Posição:\n                </span>\n                <span class="metadata-value">${e.index}</span>\n            </div>\n        `;m.innerHTML=t}(o);const i=document.getElementById("downloadCurrentBtn");i&&o.downloadUrl&&(i.href=o.downloadUrl)}function p(){const n=document.getElementById("prevPhotoBtn"),o=document.getElementById("nextPhotoBtn");n&&(n.disabled=e<=0),o&&(o.disabled=e>=t-1)}function b(){o&&e>0&&o.prev()}function E(){o&&e<t-1&&o.next()}function v(e){const t=P();t&&(a*=e,a=Math.max(.5,Math.min(a,3)),w(t),a>1?t.style.cursor="grab":(t.style.cursor="default",l={x:0,y:0}),x())}function y(){const e=P();e&&(a=1,l={x:0,y:0},w(e),e.style.cursor="default",x())}function w(e){e.style.transform=`scale(${a}) translate(${l.x}px, ${l.y}px)`}function x(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),n=document.getElementById("originalSizeBtn");e&&(e.disabled=a>=3),t&&(t.disabled=a<=.5),n&&(n.disabled=1===a&&0===l.x&&0===l.y)}function P(){if(!c)return null;const e=c.querySelector(".carousel-item.active");return e?e.querySelector("img"):null}function L(e){const t=P();if(!t||a<=1)return;i=!0;const n=e.type.includes("touch")?e.touches[0]:e;s.x=n.clientX-l.x,s.y=n.clientY-l.y,t.style.cursor="grabbing",e.preventDefault()}function k(e){const t=P();if(!i||!t||a<=1)return;const n=e.type.includes("touch")?e.touches[0]:e;l.x=n.clientX-s.x,l.y=n.clientY-s.y,w(t),e.preventDefault()}function B(){const e=P();i&&e&&(i=!1,e.style.cursor=a>1?"grab":"default")}function I(){r?S():c&&(c.requestFullscreen?c.requestFullscreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():c.msRequestFullscreen&&c.msRequestFullscreen())}function S(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function T(){r=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const e=document.getElementById("fullPageBtn");if(e){const t=e.querySelector("i");t&&(t.className=r?"bi bi-fullscreen-exit":"bi bi-arrows-fullscreen"),e.title=r?"Sair da Tela Cheia":"Tela Cheia"}c&&c.classList.toggle("fullscreen-mode",r)}function C(){if(e>=0&&e<n.length){const t=n[e];if(t.downloadUrl){const e=document.createElement("a");e.href=t.downloadUrl,e.download=t.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}}function F(){y(),o&&o._setCarouselHeight()}function A(){const e=document.querySelector("[name=csrfmiddlewaretoken]");return e?e.value:""}return document.addEventListener("fullscreenchange",T),document.addEventListener("webkitfullscreenchange",T),document.addEventListener("msfullscreenchange",T),{init:function(){!function(){const o=document.getElementById("photoSeriesData");if(o)try{const r=JSON.parse(o.textContent);n=r.photos||[],t=n.length,e=0,console.log("Loaded photos data:",n)}catch(e){console.error("Error parsing photos data:",e),n=[],t=0}}(),c=document.getElementById("photoCarousel"),d=document.getElementById("photoInfoPanel"),u=document.getElementById("photoCounter"),m=document.getElementById("photoMetadata"),c&&(o=new bootstrap.Carousel(c,{interval:!1,wrap:!0,keyboard:!0}),c.addEventListener("slide.bs.carousel",h),c.addEventListener("slid.bs.carousel",f),g(e),p()),function(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),n=document.getElementById("originalSizeBtn"),o=document.getElementById("fullPageBtn");e&&e.addEventListener("click",(()=>v(1.2))),t&&t.addEventListener("click",(()=>v(.8))),n&&n.addEventListener("click",y),o&&o.addEventListener("click",I);const r=document.getElementById("downloadCurrentBtn");r&&r.addEventListener("click",C);const a=document.getElementById("prevPhotoBtn"),i=document.getElementById("nextPhotoBtn");a&&a.addEventListener("click",b),i&&i.addEventListener("click",E),c&&(c.addEventListener("mousedown",L),document.addEventListener("mousemove",k),document.addEventListener("mouseup",B),c.addEventListener("touchstart",L),document.addEventListener("touchmove",k),document.addEventListener("touchend",B))}(),document.addEventListener("keydown",(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case"ArrowLeft":e.preventDefault(),b();break;case"ArrowRight":e.preventDefault(),E();break;case"+":case"=":e.preventDefault(),v(1.2);break;case"-":e.preventDefault(),v(.8);break;case"0":e.preventDefault(),y();break;case"f":case"F":e.preventDefault(),I();break;case"Escape":r&&(e.preventDefault(),S())}})),window.addEventListener("resize",F),window.addEventListener("orientationchange",(function(){setTimeout(F,100)})),console.log("PhotoSeries initialized with",t,"photos")},previousPhoto:b,nextPhoto:E,goToPhoto:function(e){o&&e>=0&&e<t&&o.to(e)},zoomPhoto:v,resetZoom:y,toggleFullscreen:I,downloadCurrentPhoto:C,initializeMultiUpload:function(){console.log("PhotoSeries multi-upload: Delegating to MultiUpload interface")},initializeBreadcrumbNavigation:function(){document.querySelectorAll(".breadcrumb-link").forEach((e=>{e.addEventListener("click",(function(e){this.classList.add("loading")}))}))},addPhotoToSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/add-photo/`,{method:"POST",body:t,headers:{"X-CSRFToken":A()}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao adicionar foto");window.location.reload()})).catch((e=>{console.error("Error adding photo:",e),showUploadError(e.message)}))},removePhotoFromSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/remove-photo/${t}/`,{method:"POST",headers:{"X-CSRFToken":A(),"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao remover foto");window.location.reload()})).catch((e=>{console.error("Error removing photo:",e),alert("Erro ao remover foto: "+e.message)}))},reorderPhotos:function(e,t){return fetch(`/mediafiles/photo-series/${e}/reorder/`,{method:"POST",headers:{"X-CSRFToken":A(),"Content-Type":"application/json"},body:JSON.stringify({photo_order:t})}).then((e=>e.json())).then((e=>{if(e.success)return console.log("Photos reordered successfully"),e;throw new Error(e.error||"Erro ao reordenar fotos")})).catch((e=>{console.error("Error reordering photos:",e),alert("Erro ao reordenar fotos: "+e.message)}))},returnToTimeline:function(){const e=document.querySelector("[data-timeline-url]");e?window.location.href=e.dataset.timelineUrl:window.history.back()},initializeTimelinePhotoSeries:function(){const e=document.querySelectorAll(".photoseries-thumbnail-wrapper");e.forEach((e=>{e.addEventListener("click",(function(e){if(e.target.closest(".btn")||e.target.closest(".dropdown"))return;const t=this.getAttribute("data-trigger"),n=this.getAttribute("data-gallery-id");if("lightbox"===t&&n&&window.PhotoLightbox&&window.PhotoLightbox.open){e.preventDefault(),console.log("PhotoSeries: Opening lightbox for gallery:",n);try{return void PhotoLightbox.open(0,n)}catch(e){console.warn("PhotoSeries: Failed to open PhotoLightbox:",e)}}else console.warn("PhotoSeries: Lightbox not available or missing data:",{trigger:t,galleryId:n,hasPhotoLightbox:!(!window.PhotoLightbox||!window.PhotoLightbox.open)});const o=this.closest(".timeline-card");if(o){const e=`/mediafiles/photo-series/${o.getAttribute("aria-labelledby").replace("event-","").replace("-title","")}/`;window.location.href=e}}))})),e.forEach((e=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("aria-label")||e.setAttribute("aria-label","Visualizar série de fotos"),e.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())}))}))},getCurrentIndex:()=>e,getTotalPhotos:()=>t,getPhotos:()=>n}}();