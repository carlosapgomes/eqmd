(()=>{"use strict";var e,t={340:(e,t,o)=>{o.d(t,{JF:()=>s});var n=o(122),r=o(816),a=o.n(r);const i={maxSizeMB:2,maxWidthOrHeight:1920,useWebWorker:!0,initialQuality:.8,mimeType:"image/jpeg"};async function s(e){console.log(`Processing ${e.name}...`);try{const t=await async function(e){const t=e.name.toLowerCase();if(t.endsWith(".heic")||t.endsWith(".heif")||"image/heic"===e.type||"image/heif"===e.type){console.log("Converting HEIC/HEIF to JPEG...");try{const t=await a()({blob:e,toType:"image/jpeg",quality:.9}),o=Array.isArray(t)?t[0]:t,n=e.name.replace(/\.(heic|heif)$/i,".jpg");return new File([o],n,{type:"image/jpeg"})}catch(e){throw console.error("HEIC conversion failed:",e),new Error("Falha ao converter imagem HEIC.")}}return e}(e),o=await(0,n.A)(t,i),r=new File([o],t.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return console.log(`Processed ${e.name}: ${l(e.size)} → ${l(r.size)}`),r}catch(t){throw console.error("Image processing failed:",t),new Error(`Falha ao processar ${e.name}: ${t.message}`)}}function l(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}},494:(e,t,o)=>{var n=o(340);window.PhotoSeries=function(){let e=0,t=0,o=[],r=null,a=!1,i=1,s=!1,l={x:0,y:0},c={x:0,y:0},d=null,u=null,m=null,h=null;function f(e){E()}function p(t){const o=d.querySelector(".carousel-item.active");if(o){const t=parseInt(o.dataset.photoIndex)||0;e=t,g(e),v()}}function g(e){if(e<0||e>=o.length)return;const n=o[e],r=document.getElementById("photoCounter"),a=document.getElementById("currentPhotoIndex");r&&(r.textContent=`${e+1} de ${t}`),a&&(a.textContent=e+1),h&&n&&function(e){if(!h)return;const t=`\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-file-earmark-text me-1"></i>\n                    Arquivo:\n                </span>\n                <span class="metadata-value">${e.filename}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hdd me-1"></i>\n                    Tamanho:\n                </span>\n                <span class="metadata-value">${e.size||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-aspect-ratio me-1"></i>\n                    Dimensões:\n                </span>\n                <span class="metadata-value">${e.dimensions||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hash me-1"></i>\n                    Posição:\n                </span>\n                <span class="metadata-value">${e.index}</span>\n            </div>\n        `;h.innerHTML=t}(n);const i=document.getElementById("downloadCurrentBtn");i&&n.downloadUrl&&(i.href=n.downloadUrl)}function v(){const o=document.getElementById("prevPhotoBtn"),n=document.getElementById("nextPhotoBtn");o&&(o.disabled=e<=0),n&&(n.disabled=e>=t-1)}function y(){r&&e>0&&r.prev()}function b(){r&&e<t-1&&r.next()}function w(e){const t=k();t&&(i*=e,i=Math.max(.5,Math.min(i,3)),x(t),i>1?t.style.cursor="grab":(t.style.cursor="default",c={x:0,y:0}),P())}function E(){const e=k();e&&(i=1,c={x:0,y:0},x(e),e.style.cursor="default",P())}function x(e){e.style.transform=`scale(${i}) translate(${c.x}px, ${c.y}px)`}function P(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),o=document.getElementById("originalSizeBtn");e&&(e.disabled=i>=3),t&&(t.disabled=i<=.5),o&&(o.disabled=1===i&&0===c.x&&0===c.y)}function k(){if(!d)return null;const e=d.querySelector(".carousel-item.active");return e?e.querySelector("img"):null}function B(e){const t=k();if(!t||i<=1)return;s=!0;const o=e.type.includes("touch")?e.touches[0]:e;l.x=o.clientX-c.x,l.y=o.clientY-c.y,t.style.cursor="grabbing",e.preventDefault()}function L(e){const t=k();if(!s||!t||i<=1)return;const o=e.type.includes("touch")?e.touches[0]:e;c.x=o.clientX-l.x,c.y=o.clientY-l.y,x(t),e.preventDefault()}function I(){const e=k();s&&e&&(s=!1,e.style.cursor=i>1?"grab":"default")}function F(){a?S():d&&(d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen?d.webkitRequestFullscreen():d.msRequestFullscreen&&d.msRequestFullscreen())}function S(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function C(){a=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const e=document.getElementById("fullPageBtn");if(e){const t=e.querySelector("i");t&&(t.className=a?"bi bi-fullscreen-exit":"bi bi-arrows-fullscreen"),e.title=a?"Sair da Tela Cheia":"Tela Cheia"}d&&d.classList.toggle("fullscreen-mode",a)}function T(){if(e>=0&&e<o.length){const t=o[e];if(t.downloadUrl){const e=document.createElement("a");e.href=t.downloadUrl,e.download=t.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}}function $(){E(),r&&r._setCarouselHeight()}function O(){const e=document.querySelector("[name=csrfmiddlewaretoken]");return e?e.value:""}return document.addEventListener("fullscreenchange",C),document.addEventListener("webkitfullscreenchange",C),document.addEventListener("msfullscreenchange",C),{init:function(){!function(){const n=document.getElementById("photoSeriesData");if(n)try{const r=JSON.parse(n.textContent);o=r.photos||[],t=o.length,e=0,console.log("Loaded photos data:",o)}catch(e){console.error("Error parsing photos data:",e),o=[],t=0}}(),d=document.getElementById("photoCarousel"),u=document.getElementById("photoInfoPanel"),m=document.getElementById("photoCounter"),h=document.getElementById("photoMetadata"),d&&(r=new bootstrap.Carousel(d,{interval:!1,wrap:!0,keyboard:!0}),d.addEventListener("slide.bs.carousel",f),d.addEventListener("slid.bs.carousel",p),g(e),v()),function(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),o=document.getElementById("originalSizeBtn"),n=document.getElementById("fullPageBtn");e&&e.addEventListener("click",(()=>w(1.2))),t&&t.addEventListener("click",(()=>w(.8))),o&&o.addEventListener("click",E),n&&n.addEventListener("click",F);const r=document.getElementById("downloadCurrentBtn");r&&r.addEventListener("click",T);const a=document.getElementById("prevPhotoBtn"),i=document.getElementById("nextPhotoBtn");a&&a.addEventListener("click",y),i&&i.addEventListener("click",b),d&&(d.addEventListener("mousedown",B),document.addEventListener("mousemove",L),document.addEventListener("mouseup",I),d.addEventListener("touchstart",B),document.addEventListener("touchmove",L),document.addEventListener("touchend",I))}(),document.addEventListener("keydown",(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case"ArrowLeft":e.preventDefault(),y();break;case"ArrowRight":e.preventDefault(),b();break;case"+":case"=":e.preventDefault(),w(1.2);break;case"-":e.preventDefault(),w(.8);break;case"0":e.preventDefault(),E();break;case"f":case"F":e.preventDefault(),F();break;case"Escape":a&&(e.preventDefault(),S())}})),window.addEventListener("resize",$),window.addEventListener("orientationchange",(function(){setTimeout($,100)})),console.log("PhotoSeries initialized with",t,"photos")},previousPhoto:y,nextPhoto:b,goToPhoto:function(e){r&&e>=0&&e<t&&r.to(e)},zoomPhoto:w,resetZoom:E,toggleFullscreen:F,downloadCurrentPhoto:T,initializeMultiUpload:function(){console.log("PhotoSeries multi-upload: Delegating to MultiUpload interface")},initializeMultiUploadWithProcessing:function(){if(window.MultiUpload&&window.MultiUpload.processFiles){const e=window.MultiUpload.processFiles;window.MultiUpload.processFiles=async function(t){const o=[];for(const e of t)try{const t=await(0,n.JF)(e);o.push(t)}catch(t){console.error("Failed to process file:",e.name,t),window.MultiUpload.showError&&window.MultiUpload.showError(`Erro ao processar ${e.name}: ${t.message}`)}return e.call(this,o)}}},initializeBreadcrumbNavigation:function(){document.querySelectorAll(".breadcrumb-link").forEach((e=>{e.addEventListener("click",(function(e){this.classList.add("loading")}))}))},addPhotoToSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/add-photo/`,{method:"POST",body:t,headers:{"X-CSRFToken":O()}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao adicionar foto");window.location.reload()})).catch((e=>{console.error("Error adding photo:",e),showUploadError(e.message)}))},removePhotoFromSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/remove-photo/${t}/`,{method:"POST",headers:{"X-CSRFToken":O(),"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao remover foto");window.location.reload()})).catch((e=>{console.error("Error removing photo:",e),alert("Erro ao remover foto: "+e.message)}))},reorderPhotos:function(e,t){return fetch(`/mediafiles/photo-series/${e}/reorder/`,{method:"POST",headers:{"X-CSRFToken":O(),"Content-Type":"application/json"},body:JSON.stringify({photo_order:t})}).then((e=>e.json())).then((e=>{if(e.success)return console.log("Photos reordered successfully"),e;throw new Error(e.error||"Erro ao reordenar fotos")})).catch((e=>{console.error("Error reordering photos:",e),alert("Erro ao reordenar fotos: "+e.message)}))},returnToTimeline:function(){const e=document.querySelector("[data-timeline-url]");e?window.location.href=e.dataset.timelineUrl:window.history.back()},initializeTimelinePhotoSeries:function(){const e=document.querySelectorAll(".photoseries-thumbnail-wrapper");e.forEach((e=>{e.addEventListener("click",(function(e){if(e.target.closest(".btn")||e.target.closest(".dropdown"))return;const t=this.getAttribute("data-trigger"),o=this.getAttribute("data-gallery-id");if("lightbox"===t&&o&&window.PhotoLightbox&&window.PhotoLightbox.open){e.preventDefault(),console.log("PhotoSeries: Opening lightbox for gallery:",o);try{return void PhotoLightbox.open(0,o)}catch(e){console.warn("PhotoSeries: Failed to open PhotoLightbox:",e)}}else console.warn("PhotoSeries: Lightbox not available or missing data:",{trigger:t,galleryId:o,hasPhotoLightbox:!(!window.PhotoLightbox||!window.PhotoLightbox.open)});const n=this.closest(".timeline-card");if(n){const e=`/mediafiles/photo-series/${n.getAttribute("aria-labelledby").replace("event-","").replace("-title","")}/`;window.location.href=e}}))})),e.forEach((e=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("aria-label")||e.setAttribute("aria-label","Visualizar série de fotos"),e.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())}))}))},processImage:n.JF,getCurrentIndex:()=>e,getTotalPhotos:()=>t,getPhotos:()=>o}}()},510:()=>{}},o={};function n(e){var r=o[e];if(void 0!==r)return r.exports;var a=o[e]={exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,o,r,a)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,r,a]=e[d],s=!0,l=0;l<o.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((e=>n.O[e](o[l])))?o.splice(l--,1):(s=!1,a<i&&(i=a));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[o,r,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={542:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var r,a,[i,s,l]=o,c=0;if(i.some((t=>0!==e[t]))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)var d=l(n)}for(t&&t(o);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},o=self.webpackChunkeqmd=self.webpackChunkeqmd||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.O(void 0,[796,447],(()=>n(494))),n.O(void 0,[796,447],(()=>n(340)));var r=n.O(void 0,[796,447],(()=>n(510)));r=n.O(r)})();