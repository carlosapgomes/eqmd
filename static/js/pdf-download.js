class PDFDownloader{constructor(){this.initialize()}initialize(){this.setupEventListeners()}setupEventListeners(){document.addEventListener("click",(e=>{e.target.closest(".pdf-download-btn")&&(e.preventDefault(),this.handlePdfDownload(e.target.closest(".pdf-download-btn")))}))}async handlePdfDownload(e){const t=e.dataset.pdfUrl,o=e.dataset.filename||"document.pdf",s=e.querySelector(".pdf-btn-content"),n=e.querySelector(".pdf-btn-spinner");if(t)try{this.setLoadingState(e,s,n,!0);const a=await this.fetchWithTimeout(t,3e4);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=a.headers.get("content-type");if(!r||!r.includes("application/pdf"))throw new Error("Response is not a PDF file");const i=await a.blob();if(0===i.size)throw new Error("PDF file is empty");const d=URL.createObjectURL(i);this.downloadFile(d,o),this.openInNewTab(d),this.scheduleCleanup(d),this.showSuccessMessage("PDF gerado com sucesso!")}catch(e){console.error("Error downloading PDF:",e),this.showErrorMessage(this.getErrorMessage(e))}finally{this.setLoadingState(e,s,n,!1)}else console.error("PDF URL not found")}async fetchWithTimeout(e,t=3e4){const o=new AbortController,s=setTimeout((()=>o.abort()),t);try{const t=await fetch(e,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},signal:o.signal});return clearTimeout(s),t}catch(e){throw clearTimeout(s),e}}setLoadingState(e,t,o,s){s?(t?.classList.add("d-none"),o?.classList.remove("d-none"),e.disabled=!0,e.style.cursor="wait"):(t?.classList.remove("d-none"),o?.classList.add("d-none"),e.disabled=!1,e.style.cursor="")}downloadFile(e,t){const o=document.createElement("a");o.href=e,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}openInNewTab(e){setTimeout((()=>{window.open(e,"_blank")}),100)}scheduleCleanup(e){setTimeout((()=>{URL.revokeObjectURL(e)}),2e3)}getErrorMessage(e){return"AbortError"===e.name?"Tempo esgotado. Tente novamente.":e.message.includes("HTTP error! status: 404")?"PDF não encontrado.":e.message.includes("HTTP error! status: 500")?"Erro interno do servidor. Tente novamente.":e.message.includes("not a PDF file")?"Arquivo recebido não é um PDF válido.":e.message.includes("empty")?"PDF gerado está vazio.":"Erro ao gerar PDF. Tente novamente."}showSuccessMessage(e){this.showMessage(e,"success","check-circle")}showErrorMessage(e){this.showMessage(e,"danger","exclamation-triangle")}showMessage(e,t,o){document.querySelectorAll(".pdf-download-message").forEach((e=>e.remove()));const s=document.createElement("div");s.className=`alert alert-${t} alert-dismissible fade show position-fixed pdf-download-message`,s.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 400px;",s.innerHTML=`\n      <i class="bi bi-${o} me-2"></i>\n      ${e}\n      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n    `,document.body.appendChild(s),setTimeout((()=>{s.parentNode&&(s.classList.remove("show"),setTimeout((()=>{s.parentNode&&s.parentNode.removeChild(s)}),150))}),5e3)}}document.addEventListener("DOMContentLoaded",(function(){new PDFDownloader})),"undefined"!=typeof module&&module.exports&&(module.exports=PDFDownloader);