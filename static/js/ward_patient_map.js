class WardPatientMap{constructor(){this.init()}init(){this.bindStaticEvents(),this.bindTreeEvents(),this.checkIfFiltersCleared(),this.loadStateFromSession()}bindStaticEvents(){document.getElementById("expand-all")?.addEventListener("click",(()=>{this.expandAll()})),document.getElementById("collapse-all")?.addEventListener("click",(()=>{this.collapseAll()})),document.getElementById("refresh-data")?.addEventListener("click",(()=>{this.refreshData()}))}bindTreeEvents(){document.querySelectorAll(".ward-toggle").forEach((e=>{e.addEventListener("click",(e=>{this.toggleWard(e.target.closest(".ward-toggle"))}))})),document.querySelectorAll(".patient-item").forEach((e=>{e.addEventListener("click",(t=>{if(!t.target.closest(".btn")){const t=e.querySelector('a[href*="timeline"]');t&&(window.location.href=t.href)}}))}))}toggleWard(e){const t=e.dataset.ward,s=document.getElementById("ward-"+t),a=e.querySelector("i"),o=s.classList.contains("show");o?(s.style.height=s.scrollHeight+"px",s.offsetHeight,s.style.height="0px",s.classList.remove("show"),a.classList.remove("bi-chevron-down"),a.classList.add("bi-chevron-right"),e.setAttribute("aria-expanded","false")):(s.style.height="0px",s.classList.add("show"),s.style.height=s.scrollHeight+"px",a.classList.remove("bi-chevron-right"),a.classList.add("bi-chevron-down"),e.setAttribute("aria-expanded","true"),setTimeout((()=>{s.style.height="auto"}),300)),this.saveWardState(t,!o)}expandAll(){document.querySelectorAll(".ward-toggle").forEach((e=>{const t=e.dataset.ward;document.getElementById("ward-"+t).classList.contains("show")||this.toggleWard(e)}))}collapseAll(){document.querySelectorAll(".ward-toggle").forEach((e=>{const t=e.dataset.ward;document.getElementById("ward-"+t).classList.contains("show")&&this.toggleWard(e)}))}saveWardState(e,t){const s=JSON.parse(sessionStorage.getItem("wardStates")||"{}");s[e]=t,sessionStorage.setItem("wardStates",JSON.stringify(s))}checkIfFiltersCleared(){const e=new URLSearchParams(window.location.search);e.get("q")||e.get("ward")||e.get("tag")||e.get("show_empty_wards")||sessionStorage.removeItem("wardStates")}loadStateFromSession(){const e=JSON.parse(sessionStorage.getItem("wardStates")||"{}");Object.keys(e).forEach((t=>{const s=document.querySelector(`[data-ward="${t}"]`),a=document.getElementById("ward-"+t);s&&a&&e[t]!==a.classList.contains("show")&&this.toggleWard(s)}))}async refreshData(){const e=document.getElementById("refresh-data"),t=e?.innerHTML;try{e&&(e.disabled=!0,e.innerHTML='<i class="bi bi-arrow-clockwise me-1 spin"></i>Atualizando...'),window.location.reload()}catch(s){console.error("Failed to refresh data:",s),e&&(e.innerHTML='<i class="bi bi-exclamation-circle me-1"></i>Erro',setTimeout((()=>{e.innerHTML=t,e.disabled=!1}),2e3))}}}function toggleEmptyWards(){const e=document.getElementById("show-empty-wards"),t=new URLSearchParams(window.location.search);e.checked?t.set("show_empty_wards","true"):t.delete("show_empty_wards"),window.location.search=t.toString()}document.addEventListener("DOMContentLoaded",(function(){new WardPatientMap}));