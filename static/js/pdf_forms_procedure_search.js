!function(){"use strict";function e(){this.config=window.pdfFormsProcedureSearch||{},this.inputs=Array.from(document.querySelectorAll(".procedure-search-input")),this.timeouts=new Map,this.config.searchUrl&&0!==this.inputs.length&&this.init()}e.prototype.init=function(){var e=this;this.inputs.forEach((function(t){t.addEventListener("keydown",(function(e){"Enter"===e.key&&e.preventDefault()})),t.addEventListener("input",(function(){e.handleInput(t)}))})),document.addEventListener("click",(function(t){t.target.closest(".procedure-search-input")||t.target.closest(".procedure-results")||e.hideAllResults()})),new Set(this.inputs.map((function(e){return e.form}))).forEach((function(t){t&&t.addEventListener("submit",(function(n){e.handleSubmit(n,t)}))}))},e.prototype.getResultsContainer=function(e){var t=e.closest(".procedure-search-group");return t?t.querySelector(".procedure-results"):null},e.prototype.getSpinner=function(e){var t=e.closest(".input-group");return t?t.querySelector(".search-spinner"):null},e.prototype.getHiddenField=function(e,t){return t&&e.form?e.form.querySelector('[name="'+t+'"]'):null},e.prototype.clearSelection=function(e){var t=e.dataset.procedureCodeField,n=e.dataset.procedureDescriptionField,r=this.getHiddenField(e,t),i=this.getHiddenField(e,n);r&&(r.value=""),i&&(i.value="")},e.prototype.showSpinner=function(e){var t=this.getSpinner(e);t&&(t.style.display="block")},e.prototype.hideSpinner=function(e){var t=this.getSpinner(e);t&&(t.style.display="none")},e.prototype.hideAllResults=function(){document.querySelectorAll(".procedure-results").forEach((function(e){e.classList.remove("show"),e.style.display="none"}))},e.prototype.renderResults=function(e,t){var n=this.getResultsContainer(e);if(n){if(n.innerHTML="",!t.length)return n.classList.remove("show"),void(n.style.display="none");var r=this;t.forEach((function(t){var i=document.createElement("div");i.className="dropdown-item",i.style.cursor="pointer",i.innerHTML="<strong>"+t.code+'</strong><br><small class="text-muted">'+(t.short_description||t.description)+"</small>",i.addEventListener("click",(function(){r.selectProcedure(e,t)})),n.appendChild(i)})),n.classList.add("show"),n.style.display="block"}},e.prototype.selectProcedure=function(e,t){var n=e.dataset.procedureCodeField,r=e.dataset.procedureDescriptionField,i=this.getHiddenField(e,n),o=this.getHiddenField(e,r);e.value=t.code+" - "+t.description,i&&(i.value=t.code||""),o&&(o.value=t.description||"");var s=this.getResultsContainer(e);s&&(s.classList.remove("show"),s.style.display="none"),this.hideSpinner(e)},e.prototype.handleInput=function(e){var t=e.value.trim(),n=this.getResultsContainer(e);if(this.clearSelection(e),this.timeouts.has(e)&&clearTimeout(this.timeouts.get(e)),t.length<2)return n&&(n.classList.remove("show"),n.style.display="none"),void this.hideSpinner(e);var r=this,i=setTimeout((function(){r.showSpinner(e);var n=r.config.searchUrl+"?q="+encodeURIComponent(t)+"&limit=10";fetch(n,{credentials:"same-origin"}).then((function(e){return e.json()})).then((function(t){r.hideSpinner(e),r.renderResults(e,t&&t.results?t.results:[])})).catch((function(){r.hideSpinner(e),console.error("Error searching procedures")}))}),300);this.timeouts.set(e,i)},e.prototype.handleSubmit=function(e,t){for(var n=this.inputs.filter((function(e){return e.form===t})),r=0;r<n.length;r+=1){var i=n[r],o="true"===i.dataset.procedureRequired,s=i.value.trim(),u=i.dataset.procedureCodeField,d=i.dataset.procedureDescriptionField,c=this.getHiddenField(i,u),l=this.getHiddenField(i,d),a=c?c.value.trim():"",p=l?l.value.trim():"";if(o&&!a&&!p)return e.preventDefault(),alert("Selecione o procedimento a partir da lista."),void i.focus();if(s&&(!a||!p))return e.preventDefault(),alert("Selecione um procedimento válido da lista de sugestões."),void i.focus()}},document.addEventListener("DOMContentLoaded",(function(){new e}))}();