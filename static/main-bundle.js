(()=>{"use strict";function e(e,o,n=null){const i=e.querySelector("i"),a=i.className;o?(i.className="bi bi-check me-1",e.classList.remove("btn-outline-secondary"),e.classList.add("btn-success"),t("Conteúdo copiado para a área de transferência!","success")):(i.className="bi bi-x me-1",e.classList.remove("btn-outline-secondary"),e.classList.add("btn-danger"),t(n||"Erro ao copiar conteúdo","danger")),setTimeout((()=>{i.className=a,e.classList.remove("btn-success","btn-danger"),e.classList.add("btn-outline-secondary")}),2e3)}function t(e,t="info"){let o=document.querySelector(".toast-container");o||(o=document.createElement("div"),o.className="toast-container position-fixed top-0 end-0 p-3",o.style.zIndex="1055",document.body.appendChild(o));const n="toast-"+Date.now(),i=document.createElement("div");i.id=n,i.className=`toast align-items-center text-bg-${t} border-0`,i.role="alert",i.ariaLive="assertive",i.ariaAtomic="true",i.innerHTML=`\n        <div class="d-flex">\n            <div class="toast-body">\n                ${e}\n            </div>\n            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>\n    `,o.appendChild(i),void 0!==window.bootstrap&&window.bootstrap.Toast?(new window.bootstrap.Toast(i,{autohide:!0,delay:3e3}).show(),i.addEventListener("hidden.bs.toast",(function(){i.remove()}))):setTimeout((()=>{i.parentNode&&i.remove()}),3e3)}document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("click",(function(t){const o=t.target.closest(".copy-content-btn");o&&(t.preventDefault(),async function(t){const o=t.dataset.content;if(o)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(o),e(t,!0);else{const n=document.createElement("textarea");n.value=o,n.style.position="fixed",n.style.opacity="0",n.style.pointerEvents="none",document.body.appendChild(n),n.select();const i=document.execCommand("copy");if(document.body.removeChild(n),!i)throw new Error("Copy command failed");e(t,!0)}}catch(o){console.error("Failed to copy text:",o),e(t,!1,"Falha ao copiar conteúdo")}else e(t,!1,"Nenhum conteúdo para copiar")}(o))}))}))})(),window.MediaFiles=function(){"use strict";const e={maxImageSize:5242880,maxVideoSize:52428800,allowedImageTypes:["image/jpeg","image/png","image/webp"],allowedVideoTypes:["video/mp4","video/webm","video/quicktime"],allowedImageExtensions:[".jpg",".jpeg",".png",".webp"],allowedVideoExtensions:[".mp4",".webm",".mov"]},t={formatFileSize:function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileExtension:function(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()},validateFileType:function(e,t){return t.includes(e.type)},validateFileSize:function(e,t){return e.size<=t},showToast:function(e,t="info"){const o=document.createElement("div");o.className=`alert alert-${t} alert-dismissible fade show position-fixed`,o.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",o.innerHTML=`\n                <i class="bi bi-${"success"===t?"check-circle":"error"===t?"exclamation-triangle":"info-circle"} me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            `,document.body.appendChild(o),setTimeout((()=>{o.parentNode&&o.parentNode.removeChild(o)}),4e3)},debounce:function(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),e(...n)}),t)}}},o={init:function(){this.setupDragAndDrop(),this.setupFileInputs()},setupDragAndDrop:function(){document.querySelectorAll(".media-upload-area").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))}))},setupFileInputs:function(){document.querySelectorAll('input[type="file"]').forEach((e=>{e.addEventListener("change",this.handleFileSelect.bind(this))}))},handleDragOver:function(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")},handleDrop:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=e.currentTarget.querySelector('input[type="file"]');o&&(o.files=t,this.handleFileSelect({target:o}))}},handleFileSelect:function(e){const t=e.target.files[0];t&&this.validateFile(t)&&this.showPreview(t,e.target)},validateFile:function(o){const n=t.validateFileType(o,e.allowedImageTypes),i=t.validateFileType(o,e.allowedVideoTypes);if(!n&&!i)return t.showToast("Tipo de arquivo não permitido.","error"),!1;const a=n?e.maxImageSize:e.maxVideoSize;return!!t.validateFileSize(o,a)||(t.showToast(`Arquivo muito grande. Máximo: ${a/1048576}MB`,"error"),!1)},showPreview:function(e,t){const n=document.getElementById("imagePreview")||document.getElementById("videoPreview");if(!n)return;const i=new FileReader;i.onload=function(i){const a=n.querySelector("img, video");a&&(a.src=i.target.result),o.updateMetadata(e),n.style.display="block";const r=t.closest(".media-upload-area");r&&(r.style.display="none")},i.readAsDataURL(e)},updateMetadata:function(e){const o={fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),fileType:document.getElementById("fileType")};o.fileName&&(o.fileName.textContent=e.name),o.fileSize&&(o.fileSize.textContent=t.formatFileSize(e.size)),o.fileType&&(o.fileType.textContent=e.type)}},n={init:function(){this.setupPhotoModal(),this.setupZoomControls(),this.setupKeyboardNavigation()},setupPhotoModal:function(){const e=document.getElementById("photoModal");e&&(e.addEventListener("show.bs.modal",this.handleModalShow.bind(this)),e.addEventListener("hidden.bs.modal",this.handleModalHidden.bind(this)))},setupZoomControls:function(){const e=document.getElementById("photoZoomIn"),t=document.getElementById("photoZoomOut"),o=document.getElementById("photoZoomReset"),n=document.getElementById("photoFullscreenToggle"),i=document.getElementById("photoModalImage");e&&e.addEventListener("click",(()=>this.zoomIn())),t&&t.addEventListener("click",(()=>this.zoomOut())),o&&o.addEventListener("click",(()=>this.resetZoom())),n&&n.addEventListener("click",(()=>this.toggleFullscreen())),i&&(i.addEventListener("click",(e=>this.handleImageClick(e))),i.addEventListener("mousedown",(e=>this.startPan(e))),i.addEventListener("mousemove",(e=>this.updatePan(e))),i.addEventListener("mouseup",(()=>this.endPan())),i.addEventListener("mouseleave",(()=>this.endPan())),i.addEventListener("touchstart",(e=>this.startPan(e))),i.addEventListener("touchmove",(e=>this.updatePan(e))),i.addEventListener("touchend",(()=>this.endPan())))},setupKeyboardNavigation:function(){const e=document.getElementById("photoModal");e&&e.addEventListener("keydown",(t=>{switch(t.key){case"Escape":bootstrap.Modal.getInstance(e).hide();break;case"+":case"=":this.zoomIn();break;case"-":this.zoomOut();break;case"0":this.resetZoom();break;case"f":case"F":t.preventDefault(),this.toggleFullscreen()}}))},handleModalShow:function(e){const t=e.relatedTarget;if(!t)return;this.resetModalState();const o={id:t.dataset.photoId,url:t.dataset.photoUrl,title:t.dataset.photoTitle||"Foto",filename:t.dataset.photoFilename||"-",size:t.dataset.photoSize||"-",dimensions:t.dataset.photoDimensions||"-",created:t.dataset.photoCreated||"-",author:t.dataset.photoAuthor||"-"};this.updateModalContent(o),this.loadPhotoImage(o.url)},handleModalHidden:function(){this.resetModalState()},resetModalState:function(){this.currentZoom=1,this.isFullscreen=!1,this.isPanning=!1,this.panX=0,this.panY=0;const e=document.getElementById("photoModal"),t=e?.querySelector(".modal-dialog"),o=document.getElementById("photoModalContainer"),n=document.getElementById("photoModalLoading"),i=document.getElementById("photoModalError"),a=document.getElementById("photoModalImage"),r=document.getElementById("photoFullscreenToggle"),s=r?.querySelector("i");if(o&&o.classList.add("d-none"),n&&n.classList.remove("d-none"),i&&i.classList.add("d-none"),a&&(a.style.transform="scale(1)",a.style.cursor="zoom-in",a.style.maxHeight="70vh",a.style.maxWidth="",a.style.objectFit=""),t&&(t.classList.remove("modal-fullscreen"),t.classList.add("modal-xl","modal-dialog-centered")),s&&(s.className="bi bi-arrows-fullscreen"),r){r.title="Tela cheia";const e=r.querySelector(".visually-hidden");e&&(e.textContent="Tela cheia")}},updateModalContent:function(e){const t={title:document.getElementById("photoModalTitle"),filename:document.getElementById("photoModalFilename"),dimensions:document.getElementById("photoModalDimensions"),size:document.getElementById("photoModalSize"),created:document.getElementById("photoModalCreated"),author:document.getElementById("photoModalAuthor"),downloadBtn:document.getElementById("photoDownloadBtn")};t.title&&(t.title.textContent=e.title),t.filename&&(t.filename.textContent=e.filename),t.dimensions&&(t.dimensions.textContent=e.dimensions),t.size&&(t.size.textContent=e.size),t.created&&(t.created.textContent=e.created),t.author&&(t.author.textContent=e.author),t.downloadBtn&&(t.downloadBtn.href=e.url+"?download=1",t.downloadBtn.download=e.filename)},loadPhotoImage:function(e){const t=new Image,o=document.getElementById("photoModalImage"),n=document.getElementById("photoModalLoading"),i=document.getElementById("photoModalContainer"),a=document.getElementById("photoModalError");t.onload=()=>{o&&(o.src=e,o.alt=document.getElementById("photoModalFilename")?.textContent||"Photo"),n&&n.classList.add("d-none"),i&&i.classList.remove("d-none")},t.onerror=()=>{n&&n.classList.add("d-none"),a&&a.classList.remove("d-none")},t.src=e},currentZoom:1,zoomStep:.25,maxZoom:3,minZoom:.5,isFullscreen:!1,isPanning:!1,panStartX:0,panStartY:0,panX:0,panY:0,zoomIn:function(){this.currentZoom<this.maxZoom&&(this.currentZoom+=this.zoomStep,this.updateImageZoom())},zoomOut:function(){this.currentZoom>this.minZoom&&(this.currentZoom-=this.zoomStep,this.updateImageZoom())},resetZoom:function(){this.currentZoom=1,this.panX=0,this.panY=0,this.updateImageZoom()},toggleZoom:function(){this.currentZoom<this.maxZoom?this.currentZoom+=this.zoomStep:this.currentZoom=1,this.updateImageZoom()},updateImageZoom:function(){const e=document.getElementById("photoModalImage");e&&(e.style.transform=`scale(${this.currentZoom}) translate(${this.panX}px, ${this.panY}px)`,this.isPanning?e.style.cursor="grabbing":this.currentZoom>1?e.style.cursor="grab":e.style.cursor=this.currentZoom>=this.maxZoom?"zoom-out":"zoom-in")},toggleFullscreen:function(){const e=document.getElementById("photoModal"),t=e?.querySelector(".modal-dialog"),o=document.getElementById("photoModalImage"),n=document.getElementById("photoFullscreenToggle"),i=n?.querySelector("i");e&&t&&(this.isFullscreen=!this.isFullscreen,this.isFullscreen?(t.classList.remove("modal-xl","modal-dialog-centered"),t.classList.add("modal-fullscreen"),o&&(o.style.maxHeight="100vh",o.style.maxWidth="100vw",o.style.objectFit="contain"),i&&(i.className="bi bi-fullscreen-exit"),n&&(n.title="Sair da tela cheia",n.querySelector(".visually-hidden").textContent="Sair da tela cheia")):(t.classList.remove("modal-fullscreen"),t.classList.add("modal-xl","modal-dialog-centered"),o&&(o.style.maxHeight="70vh",o.style.maxWidth="",o.style.objectFit=""),i&&(i.className="bi bi-arrows-fullscreen"),n&&(n.title="Tela cheia",n.querySelector(".visually-hidden").textContent="Tela cheia")))},handleImageClick:function(e){!this.isPanning&&Math.abs(this.panStartX-e.clientX)<5&&Math.abs(this.panStartY-e.clientY)<5&&this.toggleZoom()},startPan:function(e){if(this.currentZoom<=1)return;e.preventDefault(),this.isPanning=!0;const t="touchstart"===e.type?e.touches[0].clientX:e.clientX,o="touchstart"===e.type?e.touches[0].clientY:e.clientY;this.panStartX=t-this.panX,this.panStartY=o-this.panY,this.updateImageZoom()},updatePan:function(e){if(!this.isPanning)return;e.preventDefault();const t="touchmove"===e.type?e.touches[0].clientX:e.clientX,o="touchmove"===e.type?e.touches[0].clientY:e.clientY;this.panX=t-this.panStartX,this.panY=o-this.panStartY,this.updateImageZoom()},endPan:function(){this.isPanning=!1,this.updateImageZoom()}},i={init:function(){this.setupImageModals(),this.setupZoomFunctionality()},setupImageModals:function(){document.querySelectorAll('[data-bs-toggle="modal"][data-bs-target*="imageModal"]').forEach((e=>{e.addEventListener("click",this.handleImageModalOpen.bind(this))}))},setupZoomFunctionality:function(){document.querySelectorAll(".zoomable-image").forEach((e=>{e.addEventListener("click",this.toggleZoom.bind(this))}))},handleImageModalOpen:function(e){const t=e.currentTarget.dataset.imageSrc,o=document.querySelector(e.currentTarget.dataset.bsTarget);if(o&&t){const e=o.querySelector(".modal-body img");e&&(e.src=t)}},toggleZoom:function(e){e.currentTarget.classList.toggle("zoomed")}};return{init:function(){o.init(),i.init(),n.init(),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new bootstrap.Tooltip(e)))},utils:t,config:{maxImageSize:e.maxImageSize,maxVideoSize:e.maxVideoSize,allowedImageTypes:e.allowedImageTypes,allowedVideoTypes:e.allowedVideoTypes,allowedImageExtensions:e.allowedImageExtensions,allowedVideoExtensions:e.allowedVideoExtensions},fileUpload:o,imageViewer:i,photoModal:n}}(),document.addEventListener("DOMContentLoaded",(function(){"undefined"!=typeof bootstrap&&MediaFiles.init()})),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("eventModal")&&(new bootstrap.Modal(document.getElementById("eventModal")),document.addEventListener("click",(function(e){const t=e.target.closest("[data-event-modal]");t&&(e.preventDefault(),function(e){const t=bootstrap.Modal.getInstance(document.getElementById("eventModal")),o=document.getElementById("eventModal");o.querySelector("#modal-loading").style.display="block",o.querySelector("#modal-content").style.display="none",o.querySelector("#modal-view-full").style.display="none",o.querySelector("#modal-edit").style.display="none",t.show(),fetch(`/events/${e}/api/`).then((e=>{if(!e.ok)throw new Error("Event not found");return e.json()})).then((e=>{!function(e){const t=document.getElementById("eventModal");if(t.querySelector("#modal-loading").style.display="none",t.querySelector("#modal-content").style.display="block",t.querySelector("#modal-event-type").textContent=e.event_type_display,t.querySelector("#modal-datetime").textContent=e.created_at_formatted,t.querySelector("#modal-creator").textContent=e.created_by_name,t.querySelector("#modal-event-content").innerHTML=e.content||e.description||"Sem conteúdo",e.updated_at!==e.created_at){const o=t.querySelector("#modal-updated");o.style.display="block",o.querySelector("span").textContent=`Última edição: ${e.updated_at_formatted}`}const o=t.querySelector("#modal-view-full"),n=t.querySelector("#modal-edit");o.href=e.detail_url,o.style.display="inline-block",e.can_edit&&(n.href=e.edit_url,n.style.display="inline-block")}(e)})).catch((e=>{console.error("Error loading event:",e),function(){const e=document.getElementById("eventModal");e.querySelector("#modal-loading").style.display="none",e.querySelector("#modal-content").innerHTML='\n        <div class="alert alert-danger">\n            <i class="bi bi-exclamation-triangle me-2"></i>\n            Erro ao carregar evento\n        </div>\n    ',e.querySelector("#modal-content").style.display="block"}()}))}(t.dataset.eventModal))}))),function(){const e=document.getElementById("timeline-filters");e&&(e.querySelectorAll('input[type="checkbox"], input[type="radio"], select').forEach((t=>{t.addEventListener("change",(function(){!function(){const e=document.querySelector(".timeline-events");if(e&&(e.style.opacity="0.6",e.style.pointerEvents="none",!document.querySelector(".filter-loading"))){const t=document.createElement("div");t.className="filter-loading position-absolute top-50 start-50 translate-middle",t.innerHTML='\n                <div class="spinner-border text-primary" role="status">\n                    <span class="visually-hidden">Carregando...</span>\n                </div>\n            ',e.parentElement.style.position="relative",e.parentElement.appendChild(t)}}(),setTimeout((()=>{e.submit()}),300)}))})),e.querySelectorAll('input[type="date"]').forEach((t=>{t.addEventListener("change",(function(){e.querySelectorAll('input[name="quick_date"]').forEach((e=>{""!==e.value&&(e.checked=!1)}))}))})),e.querySelectorAll('input[name="quick_date"]').forEach((t=>{t.addEventListener("change",(function(){""!==this.value&&e.querySelectorAll('input[type="date"]').forEach((e=>{e.value=""}))}))})))}(),function(){const e=document.querySelector("[data-next-page]")?.dataset.nextPage;if(!e)return;const t={root:null,rootMargin:"100px",threshold:.1},o=document.createElement("div");o.className="load-more-trigger",o.style.height="1px";const n=document.querySelector(".timeline-events");if(n){n.appendChild(o);const i=new IntersectionObserver((t=>{t.forEach((t=>{var o;t.isIntersecting&&(o=e,console.log("Loading more events from:",o),i.unobserve(t.target))}))}),t);i.observe(o)}}()})),(()=>{function e(e){const t=document.getElementById("filter-live-region");t&&(t.textContent=e,setTimeout((()=>{t.textContent=""}),1e3))}document.addEventListener("DOMContentLoaded",(function(){!function(){const t=document.querySelectorAll(".timeline-card");let o=-1;function n(n){if(n<0||n>=t.length)return;o=n;const i=t[n];t.forEach((e=>e.classList.remove("keyboard-focused"))),i.classList.add("keyboard-focused"),i.scrollIntoView({behavior:"smooth",block:"center"});const a=i.querySelector(".event-type-badge").textContent.trim(),r=i.querySelector("time").textContent.trim();e(`Evento ${n+1} de ${t.length}: ${a}, ${r}`)}document.addEventListener("keydown",(function(e){if(e.target.closest(".timeline-events"))switch(e.key){case"ArrowDown":e.preventDefault(),n(o+1);break;case"ArrowUp":e.preventDefault(),n(o-1);break;case"Home":e.preventDefault(),n(0);break;case"End":e.preventDefault(),n(t.length-1);break;case"Enter":case" ":if(o>=0){e.preventDefault();const n=t[o].querySelector(".btn-outline-primary");n&&n.click()}}}))}(),document.getElementById("filter-live-region")||function(){const e=document.createElement("div");e.id="filter-live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="visually-hidden",document.body.appendChild(e)}(),document.querySelectorAll("#timeline-filters input, #timeline-filters select").forEach((t=>{t.addEventListener("change",(function(){const t=this.name,o="checkbox"===this.type?this.checked?this.nextElementSibling.textContent:"removido":this.value||"todos";setTimeout((()=>{e(`Filtro ${t}: ${o}`)}),100)}))})),function(){const e=document.querySelector(".visually-hidden-focusable");e&&e.addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&(t.focus(),t.scrollIntoView({behavior:"smooth"}))}));const t=document.getElementById("eventModal");t&&(t.addEventListener("shown.bs.modal",(function(){const e=this.querySelector("button, input, select, textarea, a[href]");e&&e.focus()})),t.addEventListener("hidden.bs.modal",(function(){const e=document.querySelector("[data-event-modal]:focus-within");e&&e.focus()})))}()}));const t=document.createElement("style");t.textContent="\n    .keyboard-focused {\n        outline: 3px solid #0d6efd;\n        outline-offset: 2px;\n        z-index: 10;\n        position: relative;\n    }\n    \n    .timeline-card:focus-within {\n        outline: 2px solid #0d6efd;\n        outline-offset: 1px;\n    }\n    \n    .visually-hidden-focusable:focus {\n        position: static !important;\n        width: auto !important;\n        height: auto !important;\n        clip: auto !important;\n        white-space: normal !important;\n        background-color: #007bff;\n        color: white;\n        padding: 0.5rem;\n        text-decoration: none;\n        border-radius: 0.25rem;\n    }\n",document.head.appendChild(t)})(),window.Photo=function(){"use strict";const e=window.MediaFiles?window.MediaFiles.utils:{formatFileSize:function(e){if(console.warn("MediaFiles not loaded, using fallback formatFileSize"),0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileExtension:function(e){return console.warn("MediaFiles not loaded, using fallback getFileExtension"),e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()},showToast:function(e,t="info"){console.warn("MediaFiles not loaded, using fallback showToast"),alert(e)}},t=window.MediaFiles?window.MediaFiles.config:{maxImageSize:5242880,allowedImageTypes:["image/jpeg","image/png","image/webp"],allowedImageExtensions:[".jpg",".jpeg",".png",".webp"]},o={init:function(){this.setupDragAndDrop(),this.setupFileInputs(),this.setupPreviewControls()},setupDragAndDrop:function(){document.querySelectorAll(".photo-upload-form").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))}))},setupFileInputs:function(){document.querySelectorAll('input[type="file"][accept*="image"]').forEach((e=>{e.addEventListener("change",this.handleFileSelect.bind(this))}));const e=document.getElementById("uploadArea");e&&e.addEventListener("click",(function(){const t=e.querySelector('input[type="file"]');t&&t.click()}))},setupPreviewControls:function(){const e=document.querySelectorAll(".photo-preview-remove"),t=document.querySelectorAll(".photo-preview-change");e.forEach((e=>{e.addEventListener("click",this.removePreview.bind(this))})),t.forEach((e=>{e.addEventListener("click",this.changePhoto.bind(this))}))},handleDragOver:function(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")},handleDrop:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=e.currentTarget.querySelector('input[type="file"]');o&&(o.files=t,this.handleFileSelect({target:o}))}},handleFileSelect:function(e){const t=e.target.files[0];t&&(this.validatePhoto(t)?(this.showUploadProgress(),this.processPhoto(t,e.target)):e.target.value="")},validatePhoto:function(o){if(!t.allowedImageTypes.includes(o.type))return e.showToast("Tipo de arquivo não permitido. Use JPG, PNG ou WebP.","danger"),!1;const n="."+e.getFileExtension(o.name);if(!t.allowedImageExtensions.includes(n))return e.showToast("Extensão de arquivo não permitida.","danger"),!1;if(o.size>t.maxImageSize){const o=t.maxImageSize/1048576;return e.showToast(`Arquivo muito grande. Máximo: ${o}MB`,"danger"),!1}return!0},processPhoto:function(t,o){const n=new FileReader;n.onload=n=>{const i=new Image;i.onload=()=>{if(i.width>4e3||i.height>4e3)return e.showToast("Imagem muito grande. Máximo: 4000x4000px","danger"),o.value="",void this.hideUploadProgress();this.showPhotoPreview(n.target.result,t,i.width,i.height),this.hideUploadProgress(),e.showToast("Foto carregada com sucesso!","success")},i.onerror=()=>{e.showToast("Erro ao carregar a imagem.","danger"),o.value="",this.hideUploadProgress()},i.src=n.target.result},n.onerror=()=>{e.showToast("Erro ao ler o arquivo.","danger"),o.value="",this.hideUploadProgress()},n.readAsDataURL(t)},showPhotoPreview:function(e,t,o,n){const i=document.getElementById("photoPreview")||document.getElementById("imagePreview"),a=document.querySelector(".photo-upload-form")||document.getElementById("uploadArea");if(!i)return;const r=i.querySelector(".photo-preview-image")||i.querySelector("#previewImage")||i.querySelector("img");r&&(r.src=e,r.alt=t.name),this.updatePhotoMetadata(t,o,n),i.style.display="block",a&&(a.style.display="none")},updatePhotoMetadata:function(t,o,n){const i={fileName:document.getElementById("photoFileName")||document.getElementById("fileName"),fileSize:document.getElementById("photoFileSize")||document.getElementById("fileSize"),dimensions:document.getElementById("photoDimensions")||document.getElementById("dimensions"),fileType:document.getElementById("photoFileType")||document.getElementById("fileType")};i.fileName&&(i.fileName.textContent=t.name),i.fileSize&&(i.fileSize.textContent=e.formatFileSize(t.size)),i.dimensions&&(i.dimensions.textContent=`${o}x${n}px`),i.fileType&&(i.fileType.textContent=t.type)},removePreview:function(e){e.preventDefault();const t=document.getElementById("photoPreview")||document.getElementById("imagePreview"),o=document.querySelector(".photo-upload-form")||document.getElementById("uploadArea"),n=document.querySelector('input[type="file"][accept*="image"]');n&&(n.value=""),t&&(t.style.display="none"),o&&(o.style.display="block"),document.querySelectorAll(".media-error").forEach((e=>e.remove()))},changePhoto:function(e){e.preventDefault();const t=document.querySelector('input[type="file"][accept*="image"]');t&&t.click()},showUploadProgress:function(){const e=document.getElementById("photoUploadProgress");if(e){e.style.display="block";const t=e.querySelector(".photo-progress-fill"),o=e.querySelector(".photo-progress-text");if(t&&o){let e=0;const n=setInterval((()=>{e+=30*Math.random(),e>=100&&(e=100,clearInterval(n)),t.style.width=e+"%",o.textContent=`Processando... ${Math.round(e)}%`}),100)}}},hideUploadProgress:function(){const e=document.getElementById("photoUploadProgress");e&&(e.style.display="none")}};return{init:function(){o.init()},utils:e,upload:o}}(),document.addEventListener("DOMContentLoaded",(function(){Photo.init()})),window.PhotoSeries=function(){"use strict";let e=0,t=0,o=[],n=null,i=!1,a=1,r=!1,s={x:0,y:0},l={x:0,y:0},d=null,c=null,u=null,m=null;function h(e){w()}function p(t){const o=d.querySelector(".carousel-item.active");if(o){const t=parseInt(o.dataset.photoIndex)||0;e=t,f(e),g()}}function f(e){if(e<0||e>=o.length)return;const n=o[e],i=document.getElementById("photoCounter"),a=document.getElementById("currentPhotoIndex");i&&(i.textContent=`${e+1} de ${t}`),a&&(a.textContent=e+1),m&&n&&function(e){if(!m)return;const t=`\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-file-earmark-text me-1"></i>\n                    Arquivo:\n                </span>\n                <span class="metadata-value">${e.filename}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hdd me-1"></i>\n                    Tamanho:\n                </span>\n                <span class="metadata-value">${e.size||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-aspect-ratio me-1"></i>\n                    Dimensões:\n                </span>\n                <span class="metadata-value">${e.dimensions||"N/A"}</span>\n            </div>\n            <div class="metadata-item">\n                <span class="metadata-label">\n                    <i class="bi bi-hash me-1"></i>\n                    Posição:\n                </span>\n                <span class="metadata-value">${e.index}</span>\n            </div>\n        `;m.innerHTML=t}(n);const r=document.getElementById("downloadCurrentBtn");r&&n.downloadUrl&&(r.href=n.downloadUrl)}function g(){const o=document.getElementById("prevPhotoBtn"),n=document.getElementById("nextPhotoBtn");o&&(o.disabled=e<=0),n&&(n.disabled=e>=t-1)}function y(){n&&e>0&&n.prev()}function v(){n&&e<t-1&&n.next()}function E(e){const t=x();t&&(a*=e,a=Math.max(.5,Math.min(a,3)),b(t),a>1?t.style.cursor="grab":(t.style.cursor="default",l={x:0,y:0}),S())}function w(){const e=x();e&&(a=1,l={x:0,y:0},b(e),e.style.cursor="default",S())}function b(e){e.style.transform=`scale(${a}) translate(${l.x}px, ${l.y}px)`}function S(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),o=document.getElementById("originalSizeBtn");e&&(e.disabled=a>=3),t&&(t.disabled=a<=.5),o&&(o.disabled=1===a&&0===l.x&&0===l.y)}function x(){if(!d)return null;const e=d.querySelector(".carousel-item.active");return e?e.querySelector("img"):null}function I(e){const t=x();if(!t||a<=1)return;r=!0;const o=e.type.includes("touch")?e.touches[0]:e;s.x=o.clientX-l.x,s.y=o.clientY-l.y,t.style.cursor="grabbing",e.preventDefault()}function L(e){const t=x();if(!r||!t||a<=1)return;const o=e.type.includes("touch")?e.touches[0]:e;l.x=o.clientX-s.x,l.y=o.clientY-s.y,b(t),e.preventDefault()}function B(){const e=x();r&&e&&(r=!1,e.style.cursor=a>1?"grab":"default")}function M(){i?T():d&&(d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen?d.webkitRequestFullscreen():d.msRequestFullscreen&&d.msRequestFullscreen())}function T(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function P(){i=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement);const e=document.getElementById("fullPageBtn");if(e){const t=e.querySelector("i");t&&(t.className=i?"bi bi-fullscreen-exit":"bi bi-arrows-fullscreen"),e.title=i?"Sair da Tela Cheia":"Tela Cheia"}d&&d.classList.toggle("fullscreen-mode",i)}function k(){if(e>=0&&e<o.length){const t=o[e];if(t.downloadUrl){const e=document.createElement("a");e.href=t.downloadUrl,e.download=t.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}}function q(){w(),n&&n._setCarouselHeight()}function F(){const e=document.querySelector("[name=csrfmiddlewaretoken]");return e?e.value:""}return document.addEventListener("fullscreenchange",P),document.addEventListener("webkitfullscreenchange",P),document.addEventListener("msfullscreenchange",P),{init:function(){!function(){const n=document.getElementById("photoSeriesData");if(n)try{const i=JSON.parse(n.textContent);o=i.photos||[],t=o.length,e=0,console.log("Loaded photos data:",o)}catch(e){console.error("Error parsing photos data:",e),o=[],t=0}}(),d=document.getElementById("photoCarousel"),c=document.getElementById("photoInfoPanel"),u=document.getElementById("photoCounter"),m=document.getElementById("photoMetadata"),d&&(n=new bootstrap.Carousel(d,{interval:!1,wrap:!0,keyboard:!0}),d.addEventListener("slide.bs.carousel",h),d.addEventListener("slid.bs.carousel",p),f(e),g()),function(){const e=document.getElementById("zoomInBtn"),t=document.getElementById("zoomOutBtn"),o=document.getElementById("originalSizeBtn"),n=document.getElementById("fullPageBtn");e&&e.addEventListener("click",(()=>E(1.2))),t&&t.addEventListener("click",(()=>E(.8))),o&&o.addEventListener("click",w),n&&n.addEventListener("click",M);const i=document.getElementById("downloadCurrentBtn");i&&i.addEventListener("click",k);const a=document.getElementById("prevPhotoBtn"),r=document.getElementById("nextPhotoBtn");a&&a.addEventListener("click",y),r&&r.addEventListener("click",v),d&&(d.addEventListener("mousedown",I),document.addEventListener("mousemove",L),document.addEventListener("mouseup",B),d.addEventListener("touchstart",I),document.addEventListener("touchmove",L),document.addEventListener("touchend",B))}(),document.addEventListener("keydown",(function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case"ArrowLeft":e.preventDefault(),y();break;case"ArrowRight":e.preventDefault(),v();break;case"+":case"=":e.preventDefault(),E(1.2);break;case"-":e.preventDefault(),E(.8);break;case"0":e.preventDefault(),w();break;case"f":case"F":e.preventDefault(),M();break;case"Escape":i&&(e.preventDefault(),T())}})),window.addEventListener("resize",q),window.addEventListener("orientationchange",(function(){setTimeout(q,100)})),console.log("PhotoSeries initialized with",t,"photos")},previousPhoto:y,nextPhoto:v,goToPhoto:function(e){n&&e>=0&&e<t&&n.to(e)},zoomPhoto:E,resetZoom:w,toggleFullscreen:M,downloadCurrentPhoto:k,initializeMultiUpload:function(){console.log("PhotoSeries multi-upload: Delegating to MultiUpload interface")},initializeBreadcrumbNavigation:function(){document.querySelectorAll(".breadcrumb-link").forEach((e=>{e.addEventListener("click",(function(e){this.classList.add("loading")}))}))},addPhotoToSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/add-photo/`,{method:"POST",body:t,headers:{"X-CSRFToken":F()}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao adicionar foto");window.location.reload()})).catch((e=>{console.error("Error adding photo:",e),showUploadError(e.message)}))},removePhotoFromSeries:function(e,t){return fetch(`/mediafiles/photo-series/${e}/remove-photo/${t}/`,{method:"POST",headers:{"X-CSRFToken":F(),"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw new Error(e.error||"Erro ao remover foto");window.location.reload()})).catch((e=>{console.error("Error removing photo:",e),alert("Erro ao remover foto: "+e.message)}))},reorderPhotos:function(e,t){return fetch(`/mediafiles/photo-series/${e}/reorder/`,{method:"POST",headers:{"X-CSRFToken":F(),"Content-Type":"application/json"},body:JSON.stringify({photo_order:t})}).then((e=>e.json())).then((e=>{if(e.success)return console.log("Photos reordered successfully"),e;throw new Error(e.error||"Erro ao reordenar fotos")})).catch((e=>{console.error("Error reordering photos:",e),alert("Erro ao reordenar fotos: "+e.message)}))},returnToTimeline:function(){const e=document.querySelector("[data-timeline-url]");e?window.location.href=e.dataset.timelineUrl:window.history.back()},initializeTimelinePhotoSeries:function(){const e=document.querySelectorAll(".photoseries-thumbnail-wrapper");e.forEach((e=>{e.addEventListener("click",(function(e){if(e.target.closest(".btn")||e.target.closest(".dropdown"))return;const t=this.getAttribute("data-trigger"),o=this.getAttribute("data-gallery-id");if("lightbox"===t&&o&&window.PhotoLightbox&&window.PhotoLightbox.open){e.preventDefault();try{return void PhotoLightbox.open(0,o)}catch(e){console.warn("Failed to open PhotoLightbox:",e)}}const n=this.closest(".timeline-card");if(n){const e=`/mediafiles/photo-series/${n.getAttribute("aria-labelledby").replace("event-","").replace("-title","")}/`;window.location.href=e}}))})),e.forEach((e=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.hasAttribute("role")||e.setAttribute("role","button"),e.hasAttribute("aria-label")||e.setAttribute("aria-label","Visualizar série de fotos"),e.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())}))}))},getCurrentIndex:()=>e,getTotalPhotos:()=>t,getPhotos:()=>o}}(),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("photoSeriesData")&&PhotoSeries.init(),document.getElementById("uploadArea")&&PhotoSeries.initializeMultiUpload(),PhotoSeries.initializeBreadcrumbNavigation(),PhotoSeries.initializeTimelinePhotoSeries()})),window.VideoClip=function(){"use strict";const e={maxVideoDuration:120,maxVideoSize:52428800,allowedVideoTypes:["video/mp4","video/webm","video/quicktime"],allowedVideoExtensions:[".mp4",".webm",".mov"],previewMaxWidth:800,previewMaxHeight:600},t=window.MediaFiles?window.MediaFiles.utils:{formatFileSize:function(e){if(console.warn("MediaFiles not loaded, using fallback formatFileSize"),0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileExtension:function(e){return console.warn("MediaFiles not loaded, using fallback getFileExtension"),e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()},showToast:function(e,t="info"){console.warn("MediaFiles not loaded, using fallback showToast"),alert(e)},formatDuration:function(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}},o={init:function(){this.setupDragAndDrop(),this.setupFileInputs(),this.setupPreviewControls()},setupDragAndDrop:function(){document.querySelectorAll(".video-upload-form, #uploadArea").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))}))},setupFileInputs:function(){document.querySelectorAll('input[type="file"][accept*="video"]').forEach((e=>{e.addEventListener("change",this.handleFileSelect.bind(this))}));const e=document.getElementById("uploadArea");e&&e.addEventListener("click",(function(){const t=e.querySelector('input[type="file"]');t&&t.click()}))},setupPreviewControls:function(){const e=document.querySelectorAll("#removeVideo, .video-preview-remove"),t=document.querySelectorAll(".video-preview-change");e.forEach((e=>{e.addEventListener("click",this.removePreview.bind(this))})),t.forEach((e=>{e.addEventListener("click",this.changeVideo.bind(this))}))},handleDragOver:function(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")},handleDrop:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=e.currentTarget.querySelector('input[type="file"]');o&&(o.files=t,this.handleFileSelect({target:o}))}},handleFileSelect:function(e){const t=e.target.files[0];t&&(this.validateVideo(t)?(this.showUploadProgress(),this.processVideo(t,e.target)):e.target.value="")},validateVideo:function(o){if(!e.allowedVideoTypes.includes(o.type))return t.showToast("Tipo de arquivo não permitido. Use MP4, WebM ou MOV.","danger"),!1;const n="."+t.getFileExtension(o.name);if(!e.allowedVideoExtensions.includes(n))return t.showToast("Extensão de arquivo não permitida.","danger"),!1;if(o.size>e.maxVideoSize){const o=e.maxVideoSize/1048576;return t.showToast(`Arquivo muito grande. Máximo: ${o}MB`,"danger"),!1}return!0},processVideo:function(o,n){const i=document.createElement("video");i.preload="metadata",i.onloadedmetadata=()=>{if(i.duration>e.maxVideoDuration){const o=t.formatDuration(e.maxVideoDuration);return t.showToast(`Vídeo muito longo. Máximo: ${o}`,"danger"),n.value="",void this.hideUploadProgress()}this.showVideoPreview(URL.createObjectURL(o),o,i.duration),this.hideUploadProgress(),t.showToast("Vídeo carregado com sucesso!","success")},i.onerror=()=>{t.showToast("Erro ao carregar o vídeo.","danger"),n.value="",this.hideUploadProgress()},i.src=URL.createObjectURL(o)},showVideoPreview:function(e,t,o){const n=document.getElementById("videoPreview"),i=document.getElementById("uploadArea");if(!n)return;const a=n.querySelector("#previewVideo");a&&(a.src=e),this.updateVideoMetadata(t,o),n.style.display="block",i&&(i.style.display="none")},updateVideoMetadata:function(e,o){const n={fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),videoDuration:document.getElementById("videoDuration"),fileType:document.getElementById("fileType")};n.fileName&&(n.fileName.textContent=e.name),n.fileSize&&(n.fileSize.textContent=t.formatFileSize(e.size)),n.videoDuration&&(n.videoDuration.textContent=t.formatDuration(o)),n.fileType&&(n.fileType.textContent=e.type)},removePreview:function(e){e.preventDefault();const t=document.getElementById("videoPreview"),o=document.getElementById("uploadArea"),n=document.querySelector('input[type="file"][accept*="video"]');n&&(n.value=""),t&&(t.style.display="none"),o&&(o.style.display="block"),document.querySelectorAll(".media-error").forEach((e=>e.remove()))},changeVideo:function(e){e.preventDefault();const t=document.querySelector('input[type="file"][accept*="video"]');t&&t.click()},showUploadProgress:function(){const e=document.getElementById("uploadProgress");if(e){e.style.display="block";const t=e.querySelector("#progressBar");if(t){let e=0;const o=setInterval((()=>{e+=20*Math.random(),e>=100&&(e=100,clearInterval(o)),t.style.width=e+"%"}),200)}}},hideUploadProgress:function(){const e=document.getElementById("uploadProgress");e&&(e.style.display="none")}},n={init:function(){this.setupVideoPlayers(),this.setupModalControls()},setupVideoPlayers:function(){document.querySelectorAll("video").forEach((e=>{this.enhanceVideoPlayer(e)}))},enhanceVideoPlayer:function(e){e.addEventListener("loadstart",(function(){this.style.cursor="wait"})),e.addEventListener("canplay",(function(){this.style.cursor="default"})),e.addEventListener("error",(function(){console.error("Video loading error:",this.error);const e=document.createElement("div");e.className="alert alert-danger text-center",e.innerHTML='<i class="bi bi-exclamation-triangle me-2"></i>Erro ao carregar o vídeo. Tente novamente ou baixe o arquivo.',this.parentNode.replaceChild(e,this)})),e.addEventListener("keydown",(function(e){switch(e.key){case" ":e.preventDefault(),this.paused?this.play():this.pause();break;case"ArrowLeft":e.preventDefault(),this.currentTime=Math.max(0,this.currentTime-10);break;case"ArrowRight":e.preventDefault(),this.currentTime=Math.min(this.duration,this.currentTime+10);break;case"ArrowUp":e.preventDefault(),this.volume=Math.min(1,this.volume+.1);break;case"ArrowDown":e.preventDefault(),this.volume=Math.max(0,this.volume-.1);break;case"m":case"M":e.preventDefault(),this.muted=!this.muted}})),e.setAttribute("tabindex","0")},setupModalControls:function(){const e=document.getElementById("videoModal"),t=document.getElementById("modalVideo");e&&t&&(e.addEventListener("shown.bs.modal",(function(){t.focus()})),e.addEventListener("hidden.bs.modal",(function(){t.pause(),t.currentTime=0})))}};return{init:function(){o.init()},initPlayer:function(){n.init()},utils:t,upload:o,player:n,config:e}}(),document.addEventListener("DOMContentLoaded",(function(){VideoClip.init()}));