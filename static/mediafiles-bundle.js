window.MediaFiles=function(){"use strict";const e={maxImageSize:5242880,maxVideoSize:52428800,allowedImageTypes:["image/jpeg","image/png","image/webp"],allowedVideoTypes:["video/mp4","video/webm","video/quicktime"],allowedImageExtensions:[".jpg",".jpeg",".png",".webp"],allowedVideoExtensions:[".mp4",".webm",".mov"]},t={formatFileSize:function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileExtension:function(e){return e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()},validateFileType:function(e,t){return t.includes(e.type)},validateFileSize:function(e,t){return e.size<=t},showToast:function(e,t="info"){const o=document.createElement("div");o.className=`alert alert-${t} alert-dismissible fade show position-fixed`,o.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",o.innerHTML=`\n                <i class="bi bi-${"success"===t?"check-circle":"error"===t?"exclamation-triangle":"info-circle"} me-2"></i>\n                ${e}\n                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n            `,document.body.appendChild(o),setTimeout((()=>{o.parentNode&&o.parentNode.removeChild(o)}),4e3)},debounce:function(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),e(...n)}),t)}}},o={init:function(){this.setupDragAndDrop(),this.setupFileInputs()},setupDragAndDrop:function(){document.querySelectorAll(".media-upload-area").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))}))},setupFileInputs:function(){document.querySelectorAll('input[type="file"]').forEach((e=>{e.addEventListener("change",this.handleFileSelect.bind(this))}))},handleDragOver:function(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")},handleDrop:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=e.currentTarget.querySelector('input[type="file"]');o&&(o.files=t,this.handleFileSelect({target:o}))}},handleFileSelect:function(e){const t=e.target.files[0];t&&this.validateFile(t)&&this.showPreview(t,e.target)},validateFile:function(o){const n=t.validateFileType(o,e.allowedImageTypes),a=t.validateFileType(o,e.allowedVideoTypes);if(!n&&!a)return t.showToast("Tipo de arquivo não permitido.","error"),!1;const i=n?e.maxImageSize:e.maxVideoSize;return!!t.validateFileSize(o,i)||(t.showToast(`Arquivo muito grande. Máximo: ${i/1048576}MB`,"error"),!1)},showPreview:function(e,t){const n=document.getElementById("imagePreview")||document.getElementById("videoPreview");if(!n)return;const a=new FileReader;a.onload=function(a){const i=n.querySelector("img, video");i&&(i.src=a.target.result),o.updateMetadata(e),n.style.display="block";const s=t.closest(".media-upload-area");s&&(s.style.display="none")},a.readAsDataURL(e)},updateMetadata:function(e){const o={fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),fileType:document.getElementById("fileType")};o.fileName&&(o.fileName.textContent=e.name),o.fileSize&&(o.fileSize.textContent=t.formatFileSize(e.size)),o.fileType&&(o.fileType.textContent=e.type)}},n={init:function(){this.setupPhotoModal(),this.setupZoomControls(),this.setupKeyboardNavigation()},setupPhotoModal:function(){const e=document.getElementById("photoModal");e&&(e.addEventListener("show.bs.modal",this.handleModalShow.bind(this)),e.addEventListener("hidden.bs.modal",this.handleModalHidden.bind(this)))},setupZoomControls:function(){const e=document.getElementById("photoZoomIn"),t=document.getElementById("photoZoomOut"),o=document.getElementById("photoZoomReset"),n=document.getElementById("photoFullscreenToggle"),a=document.getElementById("photoModalImage");e&&e.addEventListener("click",(()=>this.zoomIn())),t&&t.addEventListener("click",(()=>this.zoomOut())),o&&o.addEventListener("click",(()=>this.resetZoom())),n&&n.addEventListener("click",(()=>this.toggleFullscreen())),a&&(a.addEventListener("click",(e=>this.handleImageClick(e))),a.addEventListener("mousedown",(e=>this.startPan(e))),a.addEventListener("mousemove",(e=>this.updatePan(e))),a.addEventListener("mouseup",(()=>this.endPan())),a.addEventListener("mouseleave",(()=>this.endPan())),a.addEventListener("touchstart",(e=>this.startPan(e))),a.addEventListener("touchmove",(e=>this.updatePan(e))),a.addEventListener("touchend",(()=>this.endPan())))},setupKeyboardNavigation:function(){const e=document.getElementById("photoModal");e&&e.addEventListener("keydown",(t=>{switch(t.key){case"Escape":bootstrap.Modal.getInstance(e).hide();break;case"+":case"=":this.zoomIn();break;case"-":this.zoomOut();break;case"0":this.resetZoom();break;case"f":case"F":t.preventDefault(),this.toggleFullscreen()}}))},handleModalShow:function(e){const t=e.relatedTarget;if(!t)return;this.resetModalState();const o={id:t.dataset.photoId,url:t.dataset.photoUrl,title:t.dataset.photoTitle||"Foto",filename:t.dataset.photoFilename||"-",size:t.dataset.photoSize||"-",dimensions:t.dataset.photoDimensions||"-",created:t.dataset.photoCreated||"-",author:t.dataset.photoAuthor||"-"};this.updateModalContent(o),this.loadPhotoImage(o.url)},handleModalHidden:function(){this.resetModalState()},resetModalState:function(){this.currentZoom=1,this.isFullscreen=!1,this.isPanning=!1,this.panX=0,this.panY=0;const e=document.getElementById("photoModal"),t=e?.querySelector(".modal-dialog"),o=document.getElementById("photoModalContainer"),n=document.getElementById("photoModalLoading"),a=document.getElementById("photoModalError"),i=document.getElementById("photoModalImage"),s=document.getElementById("photoFullscreenToggle"),l=s?.querySelector("i");if(o&&o.classList.add("d-none"),n&&n.classList.remove("d-none"),a&&a.classList.add("d-none"),i&&(i.style.transform="scale(1)",i.style.cursor="zoom-in",i.style.maxHeight="70vh",i.style.maxWidth="",i.style.objectFit=""),t&&(t.classList.remove("modal-fullscreen"),t.classList.add("modal-xl","modal-dialog-centered")),l&&(l.className="bi bi-arrows-fullscreen"),s){s.title="Tela cheia";const e=s.querySelector(".visually-hidden");e&&(e.textContent="Tela cheia")}},updateModalContent:function(e){const t={title:document.getElementById("photoModalTitle"),filename:document.getElementById("photoModalFilename"),dimensions:document.getElementById("photoModalDimensions"),size:document.getElementById("photoModalSize"),created:document.getElementById("photoModalCreated"),author:document.getElementById("photoModalAuthor"),downloadBtn:document.getElementById("photoDownloadBtn")};t.title&&(t.title.textContent=e.title),t.filename&&(t.filename.textContent=e.filename),t.dimensions&&(t.dimensions.textContent=e.dimensions),t.size&&(t.size.textContent=e.size),t.created&&(t.created.textContent=e.created),t.author&&(t.author.textContent=e.author),t.downloadBtn&&(t.downloadBtn.href=e.url+"?download=1",t.downloadBtn.download=e.filename)},loadPhotoImage:function(e){const t=new Image,o=document.getElementById("photoModalImage"),n=document.getElementById("photoModalLoading"),a=document.getElementById("photoModalContainer"),i=document.getElementById("photoModalError");t.onload=()=>{o&&(o.src=e,o.alt=document.getElementById("photoModalFilename")?.textContent||"Photo"),n&&n.classList.add("d-none"),a&&a.classList.remove("d-none")},t.onerror=()=>{n&&n.classList.add("d-none"),i&&i.classList.remove("d-none")},t.src=e},currentZoom:1,zoomStep:.25,maxZoom:3,minZoom:.5,isFullscreen:!1,isPanning:!1,panStartX:0,panStartY:0,panX:0,panY:0,zoomIn:function(){this.currentZoom<this.maxZoom&&(this.currentZoom+=this.zoomStep,this.updateImageZoom())},zoomOut:function(){this.currentZoom>this.minZoom&&(this.currentZoom-=this.zoomStep,this.updateImageZoom())},resetZoom:function(){this.currentZoom=1,this.panX=0,this.panY=0,this.updateImageZoom()},toggleZoom:function(){this.currentZoom<this.maxZoom?this.currentZoom+=this.zoomStep:this.currentZoom=1,this.updateImageZoom()},updateImageZoom:function(){const e=document.getElementById("photoModalImage");e&&(e.style.transform=`scale(${this.currentZoom}) translate(${this.panX}px, ${this.panY}px)`,this.isPanning?e.style.cursor="grabbing":this.currentZoom>1?e.style.cursor="grab":e.style.cursor=this.currentZoom>=this.maxZoom?"zoom-out":"zoom-in")},toggleFullscreen:function(){const e=document.getElementById("photoModal"),t=e?.querySelector(".modal-dialog"),o=document.getElementById("photoModalImage"),n=document.getElementById("photoFullscreenToggle"),a=n?.querySelector("i");e&&t&&(this.isFullscreen=!this.isFullscreen,this.isFullscreen?(t.classList.remove("modal-xl","modal-dialog-centered"),t.classList.add("modal-fullscreen"),o&&(o.style.maxHeight="100vh",o.style.maxWidth="100vw",o.style.objectFit="contain"),a&&(a.className="bi bi-fullscreen-exit"),n&&(n.title="Sair da tela cheia",n.querySelector(".visually-hidden").textContent="Sair da tela cheia")):(t.classList.remove("modal-fullscreen"),t.classList.add("modal-xl","modal-dialog-centered"),o&&(o.style.maxHeight="70vh",o.style.maxWidth="",o.style.objectFit=""),a&&(a.className="bi bi-arrows-fullscreen"),n&&(n.title="Tela cheia",n.querySelector(".visually-hidden").textContent="Tela cheia")))},handleImageClick:function(e){!this.isPanning&&Math.abs(this.panStartX-e.clientX)<5&&Math.abs(this.panStartY-e.clientY)<5&&this.toggleZoom()},startPan:function(e){if(this.currentZoom<=1)return;e.preventDefault(),this.isPanning=!0;const t="touchstart"===e.type?e.touches[0].clientX:e.clientX,o="touchstart"===e.type?e.touches[0].clientY:e.clientY;this.panStartX=t-this.panX,this.panStartY=o-this.panY,this.updateImageZoom()},updatePan:function(e){if(!this.isPanning)return;e.preventDefault();const t="touchmove"===e.type?e.touches[0].clientX:e.clientX,o="touchmove"===e.type?e.touches[0].clientY:e.clientY;this.panX=t-this.panStartX,this.panY=o-this.panStartY,this.updateImageZoom()},endPan:function(){this.isPanning=!1,this.updateImageZoom()}},a={init:function(){this.setupImageModals(),this.setupZoomFunctionality()},setupImageModals:function(){document.querySelectorAll('[data-bs-toggle="modal"][data-bs-target*="imageModal"]').forEach((e=>{e.addEventListener("click",this.handleImageModalOpen.bind(this))}))},setupZoomFunctionality:function(){document.querySelectorAll(".zoomable-image").forEach((e=>{e.addEventListener("click",this.toggleZoom.bind(this))}))},handleImageModalOpen:function(e){const t=e.currentTarget.dataset.imageSrc,o=document.querySelector(e.currentTarget.dataset.bsTarget);if(o&&t){const e=o.querySelector(".modal-body img");e&&(e.src=t)}},toggleZoom:function(e){e.currentTarget.classList.toggle("zoomed")}};return{init:function(){o.init(),a.init(),n.init(),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new bootstrap.Tooltip(e)))},utils:t,config:{maxImageSize:e.maxImageSize,maxVideoSize:e.maxVideoSize,allowedImageTypes:e.allowedImageTypes,allowedVideoTypes:e.allowedVideoTypes,allowedImageExtensions:e.allowedImageExtensions,allowedVideoExtensions:e.allowedVideoExtensions},fileUpload:o,imageViewer:a,photoModal:n}}();