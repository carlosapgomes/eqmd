window.VideoClip=function(){"use strict";const e={maxVideoDuration:120,maxVideoSize:52428800,allowedVideoTypes:["video/mp4","video/webm","video/quicktime"],allowedVideoExtensions:[".mp4",".webm",".mov"],previewMaxWidth:800,previewMaxHeight:600},t=window.MediaFiles?window.MediaFiles.utils:{formatFileSize:function(e){if(console.warn("MediaFiles not loaded, using fallback formatFileSize"),0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileExtension:function(e){return console.warn("MediaFiles not loaded, using fallback getFileExtension"),e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase()},showToast:function(e,t="info"){console.warn("MediaFiles not loaded, using fallback showToast"),alert(e)},formatDuration:function(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}},o={init:function(){this.setupDragAndDrop(),this.setupFileInputs(),this.setupPreviewControls()},setupDragAndDrop:function(){document.querySelectorAll(".video-upload-form, #uploadArea").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))}))},setupFileInputs:function(){document.querySelectorAll('input[type="file"][accept*="video"]').forEach((e=>{e.addEventListener("change",this.handleFileSelect.bind(this))}));const e=document.getElementById("uploadArea");e&&e.addEventListener("click",(function(){const t=e.querySelector('input[type="file"]');t&&t.click()}))},setupPreviewControls:function(){const e=document.querySelectorAll("#removeVideo, .video-preview-remove"),t=document.querySelectorAll(".video-preview-change");e.forEach((e=>{e.addEventListener("click",this.removePreview.bind(this))})),t.forEach((e=>{e.addEventListener("click",this.changeVideo.bind(this))}))},handleDragOver:function(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")},handleDrop:function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");const t=e.dataTransfer.files;if(t.length>0){const o=e.currentTarget.querySelector('input[type="file"]');o&&(o.files=t,this.handleFileSelect({target:o}))}},handleFileSelect:function(e){const t=e.target.files[0];t&&(this.validateVideo(t)?(this.showUploadProgress(),this.processVideo(t,e.target)):e.target.value="")},validateVideo:function(o){if(!e.allowedVideoTypes.includes(o.type))return t.showToast("Tipo de arquivo não permitido. Use MP4, WebM ou MOV.","danger"),!1;const i="."+t.getFileExtension(o.name);if(!e.allowedVideoExtensions.includes(i))return t.showToast("Extensão de arquivo não permitida.","danger"),!1;if(o.size>e.maxVideoSize){const o=e.maxVideoSize/1048576;return t.showToast(`Arquivo muito grande. Máximo: ${o}MB`,"danger"),!1}return!0},processVideo:function(o,i){const n=document.createElement("video");n.preload="metadata",n.onloadedmetadata=()=>{if(n.duration>e.maxVideoDuration){const o=t.formatDuration(e.maxVideoDuration);return t.showToast(`Vídeo muito longo. Máximo: ${o}`,"danger"),i.value="",void this.hideUploadProgress()}this.showVideoPreview(URL.createObjectURL(o),o,n.duration),this.hideUploadProgress(),t.showToast("Vídeo carregado com sucesso!","success")},n.onerror=()=>{t.showToast("Erro ao carregar o vídeo.","danger"),i.value="",this.hideUploadProgress()},n.src=URL.createObjectURL(o)},showVideoPreview:function(e,t,o){const i=document.getElementById("videoPreview"),n=document.getElementById("uploadArea");if(!i)return;const r=i.querySelector("#previewVideo");r&&(r.src=e),this.updateVideoMetadata(t,o),i.style.display="block",n&&(n.style.display="none")},updateVideoMetadata:function(e,o){const i={fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),videoDuration:document.getElementById("videoDuration"),fileType:document.getElementById("fileType")};i.fileName&&(i.fileName.textContent=e.name),i.fileSize&&(i.fileSize.textContent=t.formatFileSize(e.size)),i.videoDuration&&(i.videoDuration.textContent=t.formatDuration(o)),i.fileType&&(i.fileType.textContent=e.type)},removePreview:function(e){e.preventDefault();const t=document.getElementById("videoPreview"),o=document.getElementById("uploadArea"),i=document.querySelector('input[type="file"][accept*="video"]');i&&(i.value=""),t&&(t.style.display="none"),o&&(o.style.display="block"),document.querySelectorAll(".media-error").forEach((e=>e.remove()))},changeVideo:function(e){e.preventDefault();const t=document.querySelector('input[type="file"][accept*="video"]');t&&t.click()},showUploadProgress:function(){const e=document.getElementById("uploadProgress");if(e){e.style.display="block";const t=e.querySelector("#progressBar");if(t){let e=0;const o=setInterval((()=>{e+=20*Math.random(),e>=100&&(e=100,clearInterval(o)),t.style.width=e+"%"}),200)}}},hideUploadProgress:function(){const e=document.getElementById("uploadProgress");e&&(e.style.display="none")}},i={init:function(){this.setupVideoPlayers(),this.setupModalControls()},setupVideoPlayers:function(){document.querySelectorAll("video").forEach((e=>{this.enhanceVideoPlayer(e)}))},enhanceVideoPlayer:function(e){e.addEventListener("loadstart",(function(){this.style.cursor="wait"})),e.addEventListener("canplay",(function(){this.style.cursor="default"})),e.addEventListener("error",(function(){console.error("Video loading error:",this.error);const e=document.createElement("div");e.className="alert alert-danger text-center",e.innerHTML='<i class="bi bi-exclamation-triangle me-2"></i>Erro ao carregar o vídeo. Tente novamente ou baixe o arquivo.',this.parentNode.replaceChild(e,this)})),e.addEventListener("keydown",(function(e){switch(e.key){case" ":e.preventDefault(),this.paused?this.play():this.pause();break;case"ArrowLeft":e.preventDefault(),this.currentTime=Math.max(0,this.currentTime-10);break;case"ArrowRight":e.preventDefault(),this.currentTime=Math.min(this.duration,this.currentTime+10);break;case"ArrowUp":e.preventDefault(),this.volume=Math.min(1,this.volume+.1);break;case"ArrowDown":e.preventDefault(),this.volume=Math.max(0,this.volume-.1);break;case"m":case"M":e.preventDefault(),this.muted=!this.muted}})),e.setAttribute("tabindex","0")},setupModalControls:function(){const e=document.getElementById("videoModal"),t=document.getElementById("modalVideo");e&&t&&(e.addEventListener("shown.bs.modal",(function(){t.focus()})),e.addEventListener("hidden.bs.modal",(function(){t.pause(),t.currentTime=0})))}};return{init:function(){o.init()},initPlayer:function(){i.init()},utils:t,upload:o,player:i,config:e}}();