{% comment %}
Reusable form field partial template for consistent styling
Usage: {% render_form_field field %}
{% endcomment %}
{% load pdf_forms_tags %}

{% with procedure_search=field.form.procedure_search_config %}
  {% if procedure_search and field.name == procedure_search.display_field %}
    <div class="col-md-12 mb-3">
      <label for="{{ field.id_for_label }}" class="form-label">
        {{ field.label }}
        {% if field.field.required %}
        <span class="text-danger">*</span>
        {% endif %}
      </label>

      <div class="procedure-search-group position-relative">
        <div class="input-group">
          {{ field }}
          <span class="input-group-text search-spinner" style="display: none;">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </span>
        </div>
        {% if field.help_text %}
        <div class="form-text">{{ field.help_text }}</div>
        {% endif %}
        <div class="dropdown-menu procedure-results w-100 mt-0" style="max-height: 200px; overflow-y: auto;"></div>
      </div>

      {{ field.form|lookup:procedure_search.code_field }}
      {{ field.form|lookup:procedure_search.description_field }}

      {% if field.errors %}
      <div class="invalid-feedback d-block">
        {% for error in field.errors %}
          {{ error }}
        {% endfor %}
      </div>
      {% endif %}
    </div>
  {% elif procedure_search and field.name == procedure_search.code_field %}
    {# Skip rendering procedure_code field #}
  {% elif procedure_search and field.name == procedure_search.description_field %}
    {# Skip rendering procedure_code/procedure_description fields #}
  {% else %}
    <div class="col-md-6 mb-3">
      <label for="{{ field.id_for_label }}" class="form-label">
        {{ field.label }}
        {% if field.field.required %}
        <span class="text-danger">*</span>
        {% endif %}
      </label>

      {{ field }}

      {% if field.help_text %}
      <div class="form-text">{{ field.help_text }}</div>
      {% endif %}

      {% if field.errors %}
      <div class="invalid-feedback d-block">
        {% for error in field.errors %}
          {{ error }}
        {% endfor %}
      </div>
      {% endif %}
    </div>
  {% endif %}
{% endwith %}
