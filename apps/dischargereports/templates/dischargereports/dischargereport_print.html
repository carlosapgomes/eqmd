{% load static %} {% load hospital_tags %}
<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Relat√≥rio de Alta - {{ report.patient.name }} - {{
      report.discharge_date|date:"d/m/Y" }}
    </title>
    <link
      rel="stylesheet"
      href="{% static 'dischargereports/css/print.css' %}"
    />
  </head>
  <body>
    <button class="print-button no-print" onclick="window.print()">
      üñ®Ô∏è Imprimir
    </button>

    <!-- Header (appears on every page) -->
    <div class="header">
      <div class="hospital-branding">
        {% hospital_logo as logo_url %} {% if logo_url %}
        <img
          src="{{ logo_url }}"
          alt="Logo do Hospital"
          class="hospital-logo"
        />
        {% endif %}
        <div class="hospital-info">
          <div class="hospital-name">{% hospital_name %}</div>
          <div class="hospital-details">
            {% hospital_address %} | {% hospital_phone %} | {% hospital_email %}
          </div>
        </div>
      </div>
      <div class="document-title">
        <h1>Relat√≥rio de Alta</h1>
        <h2>{{ report.medical_specialty }}</h2>
      </div>
    </div>

    <!-- Patient Information - Compact Version -->
    <div class="patient-info-section">
      <h3>Identifica√ß√£o do Paciente</h3>
      <div class="patient-info-compact">
        <div class="info-line">
          <span class="info-group">
            <span class="info-label">Nome:</span>
            <span class="info-value">{{ report.patient.name }}</span>
          </span>
          <span class="info-group">
            <span class="info-label">Prontu√°rio:</span>
            <span class="info-value">{{ report.patient.current_record_number|default:"‚Äî" }}</span>
          </span>
          <span class="info-group">
            <span class="info-label">Idade:</span>
            <span class="info-value">{{ report.patient.age }} anos</span>
          </span>
        </div>
        <div class="info-line">
          <span class="info-group">
            <span class="info-label">Data de Nascimento:</span>
            <span class="info-value">{{ report.patient.birthday|date:"d/m/Y"|default:"‚Äî" }}</span>
          </span>
          <span class="info-group">
            <span class="info-label">G√™nero:</span>
            <span class="info-value">{{ report.patient.get_gender_display|default:"‚Äî" }}</span>
          </span>
        </div>
        <div class="info-line admission-discharge">
          <span class="info-group">
            <span class="info-label">Data de Admiss√£o:</span>
            <span class="info-value">{{ report.admission_date|date:"d/m/Y" }}</span>
          </span>
          <span class="info-group">
            <span class="info-label">Data de Alta:</span>
            <span class="info-value">{{ report.discharge_date|date:"d/m/Y" }}</span>
          </span>
          <span class="info-group">
            <span class="info-label">Perman√™ncia:</span>
            <span class="info-value">{{ report.discharge_date|timeuntil:report.admission_date }}</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Medical Content Sections -->
    {% if report.problems_and_diagnosis %}
    <div class="content-section">
      <h3>Problemas e Diagn√≥sticos</h3>
      <div class="content-text">
        {{ report.problems_and_diagnosis|linebreaks }}
      </div>
    </div>
    {% endif %}

    {% if report.admission_history %}
    <div class="content-section">
      <h3>Hist√≥ria da Admiss√£o</h3>
      <div class="content-text">{{ report.admission_history|linebreaks }}</div>
    </div>
    {% endif %}

    {% if report.exams_list %}
    <div class="content-section">
      <h3>Lista de Exames</h3>
      <div class="content-text">{{ report.exams_list|linebreaks }}</div>
    </div>
    {% endif %}

    {% if report.procedures_list %}
    <div class="content-section">
      <h3>Lista de Procedimentos</h3>
      <div class="content-text">{{ report.procedures_list|linebreaks }}</div>
    </div>
    {% endif %}

    {% if report.inpatient_medical_history %}
    <div class="content-section">
      <h3>Hist√≥ria M√©dica da Interna√ß√£o</h3>
      <div class="content-text">
        {{ report.inpatient_medical_history|linebreaks }}
      </div>
    </div>
    {% endif %}

    {% if report.discharge_status %}
    <div class="content-section">
      <h3>Status da Alta</h3>
      <div class="content-text">{{ report.discharge_status|linebreaks }}</div>
    </div>
    {% endif %}

    {% if report.discharge_recommendations %}
    <div class="content-section">
      <h3>Recomenda√ß√µes de Alta</h3>
      <div class="content-text">
        {{ report.discharge_recommendations|linebreaks }}
      </div>
    </div>
    {% endif %}

    <!-- Footer (appears on every page) -->
    <div class="page-footer">
      <div class="generation-info">
        <p>
          <strong>Relat√≥rio gerado em:</strong> {{ now|date:"d/m/Y √†s H:i" }}
        </p>
        <p>
          <strong>Gerado por:</strong> {{
          user.get_full_name|default:user.username }}
        </p>
      </div>

      <div class="hospital-footer">
        <div class="hospital-footer-info">
          {% hospital_name %} - {% hospital_address %}<br />
          Tel: {% hospital_phone %} | Email: {% hospital_email %}
        </div>
        <div class="sistema-credit">criado por EquipeMed</div>
      </div>
    </div>

    <script>
      // Auto-print functionality
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("print") === "true") {
          window.print();
        }
      });
    </script>
  </body>
</html>