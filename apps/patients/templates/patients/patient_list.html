{% extends "patients/patient_base.html" %}
{% load static %}
{% block title %}Patients{% endblock %}
{% block patient_content %}
<div
  class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
>
  <h1 class="h2">Patients</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <a
      href="{% url 'patients:patient_create' %}"
      class="btn btn-sm btn-outline-primary"
    >
      <i class="bi bi-person-plus"></i> Add Patient
    </a>
  </div>
</div>

<!-- Search form -->
<form method="get" class="mb-4">
  <div class="input-group">
    <input
      type="text"
      name="q"
      class="form-control"
      placeholder="Search patients..."
      value="{{ request.GET.q|default:'' }}"
    />
    <button class="btn btn-outline-secondary" type="submit">
      <i class="bi bi-search"></i> Search
    </button>
  </div>
</form>

<!-- Patient list -->
{% if patient_list %}
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Birthday</th>
        <th>Status</th>
        <th>Hospital</th>
        <th>Tags</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for patient in patient_list %}
      <tr>
        <td>{{ patient.name }}</td>
        <td>{{ patient.birthday|date:"d/m/Y" }}</td>
        <td>
          {% if patient.status == 1 %}
          <span class="badge bg-success">Outpatient</span>
          {% elif patient.status == 2 %}
          <span class="badge bg-primary">Inpatient</span>
          {% elif patient.status == 3 %}
          <span class="badge bg-danger">Emergency</span>
          {% elif patient.status == 4 %}
          <span class="badge bg-secondary">Discharged</span>
          {% elif patient.status == 5 %}
          <span class="badge bg-warning">Transferred</span>
          {% endif %}
        </td>
        <td>{{ patient.current_hospital|default:"-" }}</td>
        <td>
          {% for tag in patient.tags.all %}
          <span class="badge" style="background-color: {{ tag.color }}; color: white;">
            {{ tag.name }}
          </span>
          {% empty %}
          <span class="text-muted">-</span>
          {% endfor %}
        </td>
        <td>
          <a
            href="{% url 'patients:patient_detail' pk=patient.pk %}"
            class="btn btn-sm btn-outline-info"
          >
            <i class="bi bi-eye"></i>
          </a>
          <a
            href="{% url 'patients:patient_update' pk=patient.pk %}"
            class="btn btn-sm btn-outline-primary"
          >
            <i class="bi bi-pencil"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a
        class="page-link"
        href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
        >First</a
      >
    </li>
    <li class="page-item">
      <a
        class="page-link"
        href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
        >Previous</a
      >
    </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link"
        >Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages
        }}</span
      >
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a
        class="page-link"
        href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
        >Next</a
      >
    </li>
    <li class="page-item">
      <a
        class="page-link"
        href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
        >Last</a
      >
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %} {% else %}
<div class="alert alert-info">
  No patients found.
  <a href="{% url 'patients:patient_create' %}">Add a new patient</a>.
</div>
{% endif %} {% endblock %}