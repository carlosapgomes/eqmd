{% extends "patients/patient_base.html" %}
{% block title %}Excluir Paciente{% endblock %}
{% block patient_content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Excluir Paciente</h1>
</div>

<div class="alert alert-warning">
  <div class="d-flex align-items-start">
    <i class="bi bi-exclamation-triangle-fill me-3 text-warning" style="font-size: 1.5rem;"></i>
    <div>
      <h5 class="alert-heading mb-2">Atenção: Exclusão de Paciente</h5>
      <p class="mb-2">Tem certeza de que deseja excluir o paciente <strong>"{{ object.name }}"</strong>?</p>
      <p class="mb-0">O paciente será marcado como excluído, mas os dados serão preservados. Esta ação pode ser revertida por um administrador.</p>
    </div>
  </div>
</div>

<form method="post">
  {% csrf_token %}
  
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <i class="bi bi-chat-text me-2"></i>
        Motivo da Exclusão
      </h5>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label for="deletion_reason" class="form-label">
          Motivo da exclusão <span class="text-danger">*</span>
        </label>
        <textarea
          class="form-control"
          id="deletion_reason"
          name="deletion_reason"
          rows="4"
          required
          placeholder="Por favor, explique o motivo da exclusão deste paciente..."
        ></textarea>
        <div class="form-text">
          Este campo é obrigatório e será registrado no histórico de auditoria.
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <a
      href="{% url 'apps.patients:patient_detail' pk=object.pk %}"
      class="btn btn-outline-secondary"
    >
      <i class="bi bi-arrow-left me-2"></i>Cancelar
    </a>
    <button type="submit" class="btn btn-danger">
      <i class="bi bi-trash me-2"></i>Confirmar Exclusão
    </button>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Focus on the deletion reason textarea
  document.getElementById('deletion_reason').focus();
  
  // Add form validation
  const form = document.querySelector('form');
  const textarea = document.getElementById('deletion_reason');
  
  form.addEventListener('submit', function(e) {
    const reason = textarea.value.trim();
    if (!reason) {
      e.preventDefault();
      textarea.classList.add('is-invalid');
      textarea.focus();
      
      // Add error message if it doesn't exist
      let errorDiv = document.querySelector('.invalid-feedback');
      if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.className = 'invalid-feedback';
        errorDiv.textContent = 'O motivo da exclusão é obrigatório.';
        textarea.parentNode.appendChild(errorDiv);
      }
    } else {
      textarea.classList.remove('is-invalid');
    }
  });
  
  // Remove validation error on input
  textarea.addEventListener('input', function() {
    if (this.value.trim()) {
      this.classList.remove('is-invalid');
    }
  });
});
</script>

{% endblock %}