{% extends "patients/patient_base.html" %}
{% load static %}
{% load patient_tags %}
{% block title %}{{ patient.name }}{% endblock %}
{% block patient_content %}
<div class="row">
  <div class="col-12">
    <!-- Header with Actions -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="{% url 'apps.patients:patient_list' %}" class="text-medical-teal text-decoration-none">
                <i class="bi bi-person-lines-fill me-1"></i>Pacientes
              </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">{{ patient.name }}</li>
          </ol>
        </nav>
        <h1 class="h3 text-medical-dark-gray mb-0">
          <i class="bi bi-person me-2 text-medical-primary"></i>
          {{ patient.name }}
        </h1>
      </div>
      <div class="btn-group" role="group">
        <a href="{% url 'apps.patients:patient_events_timeline' patient.pk %}" class="btn btn-outline-success">
          <i class="bi bi-clock-history me-2"></i>
          Timeline
        </a>
        <a href="{% url 'apps.patients:patient_update' patient.pk %}" class="btn btn-medical-outline-primary">
          <i class="bi bi-pencil me-2"></i>
          Editar
        </a>
        <a href="{% url 'apps.patients:patient_delete' patient.pk %}" class="btn btn-outline-danger">
          <i class="bi bi-trash me-2"></i>
          Excluir
        </a>
      </div>
    </div>

    <!-- Main Patient Information -->
    <div class="row">
      <!-- Basic Information Card -->
      <div class="col-lg-6 mb-4">
        <div class="card card-medical">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-info-circle me-2 text-medical-primary"></i>
              Informações Pessoais
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Nome Completo</label>
                <p class="form-control-plaintext text-medical-dark-gray">{{ patient.name }}</p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Data de Nascimento</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  <i class="bi bi-calendar3 me-2"></i>
                  {{ patient.birthday|date:"d/m/Y" }}
                </p>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Telefone</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  {% if patient.phone %}
                    <i class="bi bi-telephone me-2"></i>{{ patient.phone }}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Status</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  {{ patient.status|patient_status_badge }}
                </p>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label text-medical-gray">RG</label>
                <p class="form-control-plaintext text-medical-dark-gray">{{ patient.id_number|default:"-" }}</p>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label text-medical-gray">CPF</label>
                <p class="form-control-plaintext text-medical-dark-gray">{{ patient.fiscal_number|default:"-" }}</p>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label text-medical-gray">Cartão SUS</label>
                <p class="form-control-plaintext text-medical-dark-gray">{{ patient.healthcard_number|default:"-" }}</p>
              </div>
            </div>

            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label text-medical-gray">Tags</label>
                <div class="form-control-plaintext text-medical-dark-gray">
                  {% for tag in patient.tags.all %}
                  <span class="badge me-1" style="background-color: {{ tag.color }}; color: white;">
                    {{ tag.name }}
                  </span>
                  {% empty %}
                  <span class="text-muted">Nenhuma tag atribuída</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Hospital Information Card -->
      <div class="col-lg-6 mb-4">
        <div class="card card-medical">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-building me-2 text-medical-primary"></i>
              Informações Hospitalares
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Hospital Atual</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  {% if patient.current_hospital %}
                    <i class="bi bi-building me-2"></i>{{ patient.current_hospital.name }}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Ala</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  {% if patient.ward %}
                    <i class="bi bi-diagram-3 me-2"></i>
                    <span class="badge bg-secondary me-1">{{ patient.ward.abbreviation }}</span>
                    {{ patient.ward.name }}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </p>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label text-medical-gray">Leito</label>
                <p class="form-control-plaintext text-medical-dark-gray">
                  {% if patient.bed %}
                    <i class="bi bi-door-open me-2"></i>{{ patient.bed }}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </p>
              </div>
              <div class="col-md-6 mb-3">
                {% if patient.ward and patient.ward.floor %}
                  <label class="form-label text-medical-gray">Andar</label>
                  <p class="form-control-plaintext text-medical-dark-gray">
                    <i class="bi bi-building me-2"></i>{{ patient.ward.floor }}
                  </p>
                {% endif %}
              </div>
            </div>

            {% if patient.address or patient.city or patient.state or patient.zip_code %}
            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label text-medical-gray">Endereço</label>
                <div class="text-medical-dark-gray">
                  <i class="bi bi-geo-alt me-2"></i>
                  {% if patient.address %}
                    <div>{{ patient.address }}</div>
                  {% endif %}
                  {% if patient.city or patient.state or patient.zip_code %}
                    <div>
                      {% if patient.city %}{{ patient.city }}{% endif %}{% if patient.city and patient.state %}, {% endif %}{% if patient.state %}{{ patient.state }}{% endif %}{% if patient.zip_code %} - {{ patient.zip_code }}{% endif %}
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% else %}
            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label text-medical-gray">Endereço</label>
                <p class="form-control-plaintext text-muted">-</p>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Record Tracking Sections -->
    {% include 'patients/partials/record_number_section.html' %}
    {% include 'patients/partials/admission_section.html' %}


    <!-- Related Data Sections -->
    <div class="row">
      <!-- Metadata Card -->
      <div class="col-lg-4 mb-4">
        <div class="card card-medical">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-clock-history me-2 text-medical-primary"></i>
              Informações do Sistema
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label text-medical-gray">Criado em</label>
              <p class="form-control-plaintext text-medical-dark-gray">
                <i class="bi bi-calendar3 me-2"></i>
                {{ patient.created_at|date:"d/m/Y à\s H:i" }}
              </p>
            </div>
            
            {% if patient.created_by %}
            <div class="mb-3">
              <label class="form-label text-medical-gray">Criado por</label>
              <p class="form-control-plaintext text-medical-dark-gray">
                <i class="bi bi-person me-2"></i>
                {{ patient.created_by.profile.display_name|default:patient.created_by.username }}
              </p>
            </div>
            {% endif %}
            
            <div class="mb-3">
              <label class="form-label text-medical-gray">Última atualização</label>
              <p class="form-control-plaintext text-medical-dark-gray">
                <i class="bi bi-clock me-2"></i>
                {{ patient.updated_at|date:"d/m/Y à\s H:i" }}
              </p>
            </div>
            
            {% if patient.updated_by %}
            <div class="mb-3">
              <label class="form-label text-medical-gray">Atualizado por</label>
              <p class="form-control-plaintext text-medical-dark-gray">
                <i class="bi bi-person me-2"></i>
                {{ patient.updated_by.profile.display_name|default:patient.updated_by.username }}
              </p>
            </div>
            {% endif %}
            
            <div class="mb-0">
              <label class="form-label text-medical-gray">ID Único</label>
              <p class="form-control-plaintext text-medical-gray" style="font-family: monospace; font-size: 0.875rem;">
                {{ patient.id }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}
