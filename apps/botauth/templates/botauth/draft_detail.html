{% extends "base_app.html" %}
{% load static %}

{% block title %}Revisar Rascunho - {{ draft.patient.name }}{% endblock %}

{% block app_content %}
<!-- Header with breadcrumb and actions -->
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{% url 'botauth:my_drafts' %}">
        <i class="bi bi-journal-text me-1"></i>
        Meus Rascunhos
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">
      {{ draft.patient.name }} - {{ draft.event_datetime|date:"d/m/Y H:i" }}
    </li>
  </ol>
</nav>

<!-- Header with actions -->
<div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">
    <i class="bi bi-journal-medical text-medical-primary me-2"></i>
    Revisar Rascunho
    <span class="badge bg-warning text-dark ms-2">Rascunho</span>
  </h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <form method="post" action="{% url 'botauth:draft_reject' draft.pk %}" class="d-inline">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-danger btn-sm me-2"
              onclick="return confirm('Tem certeza que deseja rejeitar este rascunho?')">
        <i class="bi bi-x-circle me-1"></i>
        Rejeitar
      </button>
    </form>
    <form method="post" action="{% url 'botauth:draft_promote' draft.pk %}" class="d-inline">
      {% csrf_token %}
      <button type="submit" class="btn btn-success btn-sm me-2"
              onclick="return confirm('Confirmar a promoção deste rascunho para documento definitivo? Você se tornará o autor do registro.')">
        <i class="bi bi-check-circle me-1"></i>
        Promover a Definitivo
      </button>
    </form>
    <a href="{% url 'botauth:my_drafts' %}" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-arrow-left me-1"></i>
      Voltar
    </a>
  </div>
</div>

<!-- Draft Alert -->
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <i class="bi bi-exclamation-triangle me-2"></i>
  <strong>Atenção:</strong> Este é um rascunho criado por bot sob sua delegação.
  Revise o conteúdo cuidadosamente antes de promover para documento definitivo.
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<!-- Patient Information -->
<div class="row mb-4">
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title mb-3">
          <i class="bi bi-person me-2"></i>
          Informações do Paciente
        </h6>
        <div class="mb-2">
          <small class="text-muted">Nome:</small><br>
          <strong>{{ draft.patient.name }}</strong>
        </div>
        {% if draft.patient.birthday %}
        <div class="mb-2">
          <small class="text-muted">Nascimento:</small><br>
          <span>{{ draft.patient.birthday|date:"d/m/Y" }}</span>
        </div>
        {% endif %}
        {% if draft.patient.phone %}
        <div class="mb-2">
          <small class="text-muted">Telefone:</small><br>
          <span>{{ draft.patient.phone }}</span>
        </div>
        {% endif %}
        <hr>
        <div class="mb-2">
          <small class="text-muted">Criado via bot:</small><br>
          <strong>{{ draft.draft_created_by_bot }}</strong>
        </div>
        <div class="mb-2">
          <small class="text-muted">Delegado por:</small><br>
          <span>{{ draft.draft_delegated_by.get_full_name|default:draft.draft_delegated_by.username }}</span>
        </div>
        <div class="mb-2">
          <small class="text-muted">Expira em:</small><br>
          <span class="text-warning">{{ draft.draft_expires_at|date:"d/m/Y H:i" }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Draft Content -->
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-medical-light">
        <h5 class="card-title mb-0">
          <i class="bi bi-file-text me-2"></i>
          Conteúdo do Rascunho
        </h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <small class="text-muted">Descrição:</small><br>
          <strong>{{ draft.description }}</strong>
        </div>
        <hr>
        {% if draft.content %}
        <div class="markdown-content">
          {{ draft.content|linebreaks }}
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="bi bi-file-text text-muted" style="font-size: 2rem;"></i>
          <p class="text-muted mt-2 mb-0">Nenhum conteúdo foi adicionado a este rascunho.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  .markdown-content {
    line-height: 1.6;
  }
  
  .markdown-content p {
    margin-bottom: 1rem;
  }
  
  .markdown-content ul,
  .markdown-content ol {
    margin-bottom: 1rem;
    padding-left: 2rem;
  }
</style>
{% endblock %}